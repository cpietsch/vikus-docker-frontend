import{S as It,i as yt,s as kt,e as f,t as V,k as N,c as u,a as p,h as j,d as r,m as O,b as i,T as pt,g as Z,H as e,j as W,P as Se,U as Pt,E as ht,V as Dt,f as mt,w as St,x as Tt,y as Nt,q as Te,o as Je,B as Ot,l as vt,p as At,Q as Ut,W as Bt,X as zt,n as Ct}from"../../chunks/index-8a66d5b6.js";import{b as re,p as Qe,d as me,c as Xe,a as bt}from"../../chunks/api-a1f7356f.js";import{w as Lt}from"../../chunks/index-9fbe470e.js";import{g as Rt}from"../../chunks/navigation-0e6511d1.js";import{b as Wt}from"../../chunks/paths-396f020f.js";import"../../chunks/singletons-d1fb5791.js";const Vt=Lt();async function Ft(){const t=await(await re("GET","/openapi.json")).json();console.log("openapi",t);const n=Object.entries(t.paths).filter(([s,l])=>s.startsWith("/instances/steps/")).filter(([s,l])=>s!=="/instances/steps/zip").map(([s,{post:l}])=>({path:s,method:"POST",description:l.description,parameters:l.parameters,name:l.summary,id:l.operationId}));console.log("paths",n),Vt.set(n)}Ft();function _t(a,t,n){const s=a.slice();return s[6]=t[n],s}function gt(a){let t,n,s=a[6].description+"",l,g,h,D,E,x,b,k;return{c(){t=f("label"),n=f("span"),l=V(s),g=N(),h=f("input"),this.h()},l(m){t=u(m,"LABEL",{class:!0,for:!0});var c=p(t);n=u(c,"SPAN",{class:!0});var d=p(n);l=j(d,s),d.forEach(r),g=O(c),h=u(c,"INPUT",{name:!0,id:!0,class:!0,type:!0,step:!0}),c.forEach(r),this.h()},h(){i(n,"class","flex-auto"),i(h,"name",D=a[6].name),i(h,"id",E=a[6].name),i(h,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),i(h,"type",x=a[4](a[6])),h.value=b=a[3](a[6]),i(h,"step","any"),i(t,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),i(t,"for",k=a[6].name),pt(t,"hidden",a[6].name==="instance_id")},m(m,c){Z(m,t,c),e(t,n),e(n,l),e(t,g),e(t,h)},p(m,c){c&1&&s!==(s=m[6].description+"")&&W(l,s),c&1&&D!==(D=m[6].name)&&i(h,"name",D),c&1&&E!==(E=m[6].name)&&i(h,"id",E),c&1&&x!==(x=m[4](m[6]))&&i(h,"type",x),c&1&&b!==(b=m[3](m[6]))&&h.value!==b&&(h.value=b),c&1&&k!==(k=m[6].name)&&i(t,"for",k),c&1&&pt(t,"hidden",m[6].name==="instance_id")},d(m){m&&r(t)}}}function Gt(a){let t,n,s=a[0].name+"",l,g,h,D=a[0].description+"",E,x,b,k,m,c,d,S,z,U=a[0].parameters,y=[];for(let v=0;v<U.length;v+=1)y[v]=gt(_t(a,U,v));return{c(){t=f("div"),n=f("h1"),l=V(s),g=N(),h=f("p"),E=V(D),x=N(),b=f("form");for(let v=0;v<y.length;v+=1)y[v].c();k=N(),m=f("button"),c=V("Run"),this.h()},l(v){t=u(v,"DIV",{class:!0});var w=p(t);n=u(w,"H1",{class:!0});var I=p(n);l=j(I,s),I.forEach(r),g=O(w),h=u(w,"P",{class:!0});var L=p(h);E=j(L,D),L.forEach(r),x=O(w),b=u(w,"FORM",{});var A=p(b);for(let G=0;G<y.length;G+=1)y[G].l(A);k=O(A),m=u(A,"BUTTON",{type:!0,class:!0});var F=p(m);c=j(F,"Run"),F.forEach(r),A.forEach(r),w.forEach(r),this.h()},h(){i(n,"class","mb-2"),i(h,"class","text-sm mb-4"),i(m,"type","submit"),i(m,"class","py-2 px-3 w-40 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none"),i(t,"class",d="flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 "+(a[1]&&"grayscale pointer-events-none"))},m(v,w){Z(v,t,w),e(t,n),e(n,l),e(t,g),e(t,h),e(h,E),e(t,x),e(t,b);for(let I=0;I<y.length;I+=1)y[I].m(b,null);e(b,k),e(b,m),e(m,c),S||(z=Se(b,"submit",Pt(a[2])),S=!0)},p(v,[w]){if(w&1&&s!==(s=v[0].name+"")&&W(l,s),w&1&&D!==(D=v[0].description+"")&&W(E,D),w&25){U=v[0].parameters;let I;for(I=0;I<U.length;I+=1){const L=_t(v,U,I);y[I]?y[I].p(L,w):(y[I]=gt(L),y[I].c(),y[I].m(b,k))}for(;I<y.length;I+=1)y[I].d(1);y.length=U.length}w&2&&d!==(d="flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 "+(v[1]&&"grayscale pointer-events-none"))&&i(t,"class",d)},i:ht,o:ht,d(v){v&&r(t),Dt(y,v),S=!1,z()}}}function Ht(a,t,n){let{instance:s}=t,{path:l}=t,g=!1;const h=async x=>{n(1,g=!0);const b=new FormData(x.target),k={};for(let d of b){const[S,z]=d;k[S]=z}const c=await(await re(l.method,l.path,null,k)).json();console.log(c),n(1,g=!1)},D=x=>x.name==="instance_id"?s.id:x.schema.default,E=x=>{const b=x.schema.type;return b==="number"||b==="integer"?"number":b==="boolean"?"checkbox":"text"};return a.$$set=x=>{"instance"in x&&n(5,s=x.instance),"path"in x&&n(0,l=x.path)},[l,g,h,D,E,s]}class Mt extends It{constructor(t){super(),yt(this,t,Ht,Gt,kt,{instance:5,path:0})}}function wt(a,t,n){const s=a.slice();return s[10]=t[n],s}function xt(a){let t,n,s,l,g=a[4].completed+"",h,D,E=a[4].size+"",x,b,k,m,c=parseInt(a[4].progress*100)+"",d,S,z,U,y;return{c(){t=f("div"),n=f("div"),s=f("div"),l=f("span"),h=V(g),D=V("/"),x=V(E),b=N(),k=f("div"),m=f("span"),d=V(c),S=V("%"),z=N(),U=f("div"),y=f("div"),this.h()},l(v){t=u(v,"DIV",{class:!0});var w=p(t);n=u(w,"DIV",{class:!0});var I=p(n);s=u(I,"DIV",{});var L=p(s);l=u(L,"SPAN",{class:!0});var A=p(l);h=j(A,g),D=j(A,"/"),x=j(A,E),A.forEach(r),L.forEach(r),b=O(I),k=u(I,"DIV",{class:!0});var F=p(k);m=u(F,"SPAN",{class:!0});var G=p(m);d=j(G,c),S=j(G,"%"),G.forEach(r),F.forEach(r),I.forEach(r),z=O(w),U=u(w,"DIV",{class:!0});var ee=p(U);y=u(ee,"DIV",{style:!0,class:!0}),p(y).forEach(r),ee.forEach(r),w.forEach(r),this.h()},h(){i(l,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),i(m,"class","text-xs font-semibold inline-block text-green-600"),i(k,"class","text-right"),i(n,"class","flex mb-2 items-center justify-between"),mt(y,"width",parseInt(a[4].progress*100)+"%"),i(y,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"),i(U,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200"),i(t,"class","relative mt-2")},m(v,w){Z(v,t,w),e(t,n),e(n,s),e(s,l),e(l,h),e(l,D),e(l,x),e(n,b),e(n,k),e(k,m),e(m,d),e(m,S),e(t,z),e(t,U),e(U,y)},p(v,w){w&16&&g!==(g=v[4].completed+"")&&W(h,g),w&16&&E!==(E=v[4].size+"")&&W(x,E),w&16&&c!==(c=parseInt(v[4].progress*100)+"")&&W(d,c),w&16&&mt(y,"width",parseInt(v[4].progress*100)+"%")},d(v){v&&r(t)}}}function Et(a){let t,n;return t=new Mt({props:{instance:a[0],path:a[10]}}),{c(){St(t.$$.fragment)},l(s){Tt(t.$$.fragment,s)},m(s,l){Nt(t,s,l),n=!0},p(s,l){const g={};l&1&&(g.instance=s[0]),l&2&&(g.path=s[10]),t.$set(g)},i(s){n||(Te(t.$$.fragment,s),n=!0)},o(s){Je(t.$$.fragment,s),n=!1},d(s){Ot(t,s)}}}function Zt(a){let t,n,s,l,g,h,D=a[0].label+"",E,x,b,k=a[0].status+"",m,c,d,S,z,U,y,v,w=a[0].iiif_url+"",I,L,A,F,G,ee,te,ie=a[0].id+"",ve,Ne,q,ce,Oe,Ae,se,de=new Date(a[0].created*1e3)+"",be,Ue,J,fe,Be,ze,ae,X,ue=a[2]?"Connected":"Disconnected",_e,ge,Ce,Q,pe,Le,Re,ne,H,We,we,Fe,M,K,Ge,He,Y,Me,xe,Ee,le,oe,C,Ze,Ke,B=a[4]&&xt(a),$=a[1],P=[];for(let o=0;o<$.length;o+=1)P[o]=Et(wt(a,$,o));const jt=o=>Je(P[o],1,1,()=>{P[o]=null});return{c(){t=f("div"),n=f("div"),s=f("button"),l=V("Delete"),g=N(),h=f("h1"),E=V(D),x=N(),b=f("span"),m=V(k),c=N(),d=f("div"),S=f("div"),z=f("p"),U=V("Manifest URL"),y=N(),v=f("div"),I=V(w),L=N(),A=f("div"),F=f("p"),G=V("Id"),ee=N(),te=f("div"),ve=V(ie),Ne=N(),q=f("div"),ce=f("p"),Oe=V("Created"),Ae=N(),se=f("div"),be=V(de),Ue=N(),J=f("div"),fe=f("p"),Be=V("Socket"),ze=N(),ae=f("div"),X=f("span"),_e=V(ue),Ce=N(),Q=f("div"),pe=f("p"),Le=V("Vikus Viewer"),Re=N(),ne=f("div"),H=f("a"),We=V("Open"),Fe=N(),M=f("div"),K=f("button"),Ge=V("Generate Instance"),He=N(),Y=f("button"),Me=V("Download ZIP"),Ee=N(),B&&B.c(),le=N();for(let o=0;o<P.length;o+=1)P[o].c();oe=vt(),this.h()},l(o){t=u(o,"DIV",{class:!0});var _=p(t);n=u(_,"DIV",{class:!0});var T=p(n);s=u(T,"BUTTON",{class:!0});var he=p(s);l=j(he,"Delete"),he.forEach(r),T.forEach(r),g=O(_),h=u(_,"H1",{});var Ie=p(h);E=j(Ie,D),x=O(Ie),b=u(Ie,"SPAN",{class:!0});var Ye=p(b);m=j(Ye,k),Ye.forEach(r),Ie.forEach(r),_.forEach(r),c=O(o),d=u(o,"DIV",{class:!0});var R=p(d);S=u(R,"DIV",{class:!0});var ye=p(S);z=u(ye,"P",{});var $e=p(z);U=j($e,"Manifest URL"),$e.forEach(r),y=O(ye),v=u(ye,"DIV",{class:!0});var et=p(v);I=j(et,w),et.forEach(r),ye.forEach(r),L=O(R),A=u(R,"DIV",{class:!0});var ke=p(A);F=u(ke,"P",{});var tt=p(F);G=j(tt,"Id"),tt.forEach(r),ee=O(ke),te=u(ke,"DIV",{class:!0});var st=p(te);ve=j(st,ie),st.forEach(r),ke.forEach(r),Ne=O(R),q=u(R,"DIV",{class:!0});var De=p(q);ce=u(De,"P",{});var at=p(ce);Oe=j(at,"Created"),at.forEach(r),Ae=O(De),se=u(De,"DIV",{class:!0});var nt=p(se);be=j(nt,de),nt.forEach(r),De.forEach(r),Ue=O(R),J=u(R,"DIV",{class:!0});var Ve=p(J);fe=u(Ve,"P",{});var lt=p(fe);Be=j(lt,"Socket"),lt.forEach(r),ze=O(Ve),ae=u(Ve,"DIV",{class:!0});var ot=p(ae);X=u(ot,"SPAN",{class:!0});var rt=p(X);_e=j(rt,ue),rt.forEach(r),ot.forEach(r),Ve.forEach(r),Ce=O(R),Q=u(R,"DIV",{class:!0});var je=p(Q);pe=u(je,"P",{});var it=p(pe);Le=j(it,"Vikus Viewer"),it.forEach(r),Re=O(je),ne=u(je,"DIV",{class:!0});var ct=p(ne);H=u(ct,"A",{target:!0,class:!0,href:!0});var dt=p(H);We=j(dt,"Open"),dt.forEach(r),ct.forEach(r),je.forEach(r),Fe=O(R),M=u(R,"DIV",{class:!0});var Pe=p(M);K=u(Pe,"BUTTON",{class:!0});var ft=p(K);Ge=j(ft,"Generate Instance"),ft.forEach(r),He=O(Pe),Y=u(Pe,"BUTTON",{class:!0});var ut=p(Y);Me=j(ut,"Download ZIP"),ut.forEach(r),Pe.forEach(r),R.forEach(r),Ee=O(o),B&&B.l(o),le=O(o);for(let qe=0;qe<P.length;qe+=1)P[qe].l(o);oe=vt(),this.h()},h(){i(s,"class","p-1 pl-2 pr-2 bg-red-700 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-red-500/50 focus:outline-none"),i(n,"class","absolute top-0 right-0 bg-gray-100"),i(b,"class","px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"),i(t,"class","relative "),i(v,"class","flex items-end text-xs"),i(S,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),i(te,"class","flex items-end text-xs"),i(A,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),i(se,"class","flex items-end text-xs"),i(q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),i(X,"class",ge="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(a[2]?"bg-green-100":"bg-red-100")+" text-"+(a[2]?"green-800":"red-800")),i(ae,"class","flex items-end text-xs"),i(J,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),i(H,"target","_blank"),i(H,"class","font-semibold rounded-full px-2 bg-blue-100"),i(H,"href",we=Qe+"://"+me+":"+Xe+"/viewer/?config=../data/"+a[0].id+"/config.json"),i(ne,"class","flex items-end text-xs"),i(Q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),i(K,"class","py-2 px-3 w-40 bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none"),i(Y,"class","py-2 px-3 w-40 bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none"),i(M,"class",xe="flex justify-between mt-8 "+(a[3]&&"grayscale pointer-events-none")),i(d,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-7")},m(o,_){Z(o,t,_),e(t,n),e(n,s),e(s,l),e(t,g),e(t,h),e(h,E),e(h,x),e(h,b),e(b,m),Z(o,c,_),Z(o,d,_),e(d,S),e(S,z),e(z,U),e(S,y),e(S,v),e(v,I),e(d,L),e(d,A),e(A,F),e(F,G),e(A,ee),e(A,te),e(te,ve),e(d,Ne),e(d,q),e(q,ce),e(ce,Oe),e(q,Ae),e(q,se),e(se,be),e(d,Ue),e(d,J),e(J,fe),e(fe,Be),e(J,ze),e(J,ae),e(ae,X),e(X,_e),e(d,Ce),e(d,Q),e(Q,pe),e(pe,Le),e(Q,Re),e(Q,ne),e(ne,H),e(H,We),e(d,Fe),e(d,M),e(M,K),e(K,Ge),e(M,He),e(M,Y),e(Y,Me),Z(o,Ee,_),B&&B.m(o,_),Z(o,le,_);for(let T=0;T<P.length;T+=1)P[T].m(o,_);Z(o,oe,_),C=!0,Ze||(Ke=[Se(s,"click",a[7]),Se(K,"click",a[5]),Se(Y,"click",a[6])],Ze=!0)},p(o,[_]){if((!C||_&1)&&D!==(D=o[0].label+"")&&W(E,D),(!C||_&1)&&k!==(k=o[0].status+"")&&W(m,k),(!C||_&1)&&w!==(w=o[0].iiif_url+"")&&W(I,w),(!C||_&1)&&ie!==(ie=o[0].id+"")&&W(ve,ie),(!C||_&1)&&de!==(de=new Date(o[0].created*1e3)+"")&&W(be,de),(!C||_&4)&&ue!==(ue=o[2]?"Connected":"Disconnected")&&W(_e,ue),(!C||_&4&&ge!==(ge="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(o[2]?"bg-green-100":"bg-red-100")+" text-"+(o[2]?"green-800":"red-800")))&&i(X,"class",ge),(!C||_&1&&we!==(we=Qe+"://"+me+":"+Xe+"/viewer/?config=../data/"+o[0].id+"/config.json"))&&i(H,"href",we),(!C||_&8&&xe!==(xe="flex justify-between mt-8 "+(o[3]&&"grayscale pointer-events-none")))&&i(M,"class",xe),o[4]?B?B.p(o,_):(B=xt(o),B.c(),B.m(le.parentNode,le)):B&&(B.d(1),B=null),_&3){$=o[1];let T;for(T=0;T<$.length;T+=1){const he=wt(o,$,T);P[T]?(P[T].p(he,_),Te(P[T],1)):(P[T]=Et(he),P[T].c(),Te(P[T],1),P[T].m(oe.parentNode,oe))}for(Ct(),T=$.length;T<P.length;T+=1)jt(T);At()}},i(o){if(!C){for(let _=0;_<$.length;_+=1)Te(P[_]);C=!0}},o(o){P=P.filter(Boolean);for(let _=0;_<P.length;_+=1)Je(P[_]);C=!1},d(o){o&&r(t),o&&r(c),o&&r(d),o&&r(Ee),B&&B.d(o),o&&r(le),Dt(P,o),o&&r(oe),Ze=!1,Ut(Ke)}}}const qt={id:"test",label:"Test Instance",iiif_url:"http://localhost:5000/instances/test",status:"ok"};async function ts({params:a,fetch:t,session:n,stuff:s}){try{const l=await re("get",`/instances/${a.id}`);return{status:l.status,props:{instance:l.ok&&await l.json()}}}catch(l){return{status:l.status,props:{error:l.message,instance:qt}}}}function Jt(a,t,n){let s;Bt(a,Vt,c=>n(1,s=c));let{instance:l}=t,g=!1,h=!1,D,E=new WebSocket(`ws://${me}:${bt}/instances/${l.id}/ws`);E.onopen=c=>{console.log("eventSource.onopen",c),n(2,g=!0)},E.onerror=c=>{console.log("eventSource.onerror",c),n(2,g=!1)},E.onclose=c=>{console.log("eventSource.onclose",c),n(2,g=!1)},E.onmessage=c=>{const d=JSON.parse(c.data);d.type!="ping"&&console.log(d),d.task&&n(4,D=d)};const x=setInterval(()=>{g||(E=new WebSocket(`ws://${me}:${bt}/instances/${l.id}/ws`))},1e3);zt(()=>{console.log("It's destroyed"),n(2,g=!1),E.close(),clearInterval(x)});const b=async()=>{const d=await(await re("POST","/instances/generate",null,{instance_id:l.id})).json();console.log(d),n(3,h=!1)},k=async()=>{await(await re("POST","/instances/steps/zip",null,{instance_id:l.id})).json();const d=`${Qe}://${me}:${Xe}/data/${l.id}/project.zip`;var S=document.createElement("a");S.href=d,S.setAttribute("download","project.zip"),S.click()},m=async()=>{E.close(),(await(await re("DELETE",`/instances/${l.id}`)).json()).status=="deleted"&&Rt(Wt)};return a.$$set=c=>{"instance"in c&&n(0,l=c.instance)},a.$$.update=()=>{a.$$.dirty&2&&console.log(s)},[l,s,g,h,D,b,k,m]}class ss extends It{constructor(t){super(),yt(this,t,Jt,Zt,kt,{instance:0})}}export{ss as default,ts as load};
