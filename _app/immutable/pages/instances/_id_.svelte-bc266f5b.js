import{S as lt,i as nt,s as at,F as Qe,G as Xe,a as b,d as i,b as o,g as B,H as n,L as Nt,e as v,k as V,c as g,m as P,Q as ot,M as At,N as Tt,O as Ut,q as se,o as oe,U as Bt,t as j,h as S,V as kt,j as L,w as Ne,x as Ae,y as Te,W as Ot,X as jt,B as Ue,f as Et,l as It,p as zt,K as Ct,Y as Lt,n as Mt}from"../../chunks/index-f7dd684f.js";import{b as ge,p as et,d as Be,c as tt,a as Rt}from"../../chunks/api-a1f7356f.js";import{l as Ft,a as Ht}from"../../chunks/store-6b6edcdb.js";import{g as Wt}from"../../chunks/navigation-0e6511d1.js";import{b as Ye}from"../../chunks/paths-396f020f.js";import"../../chunks/index-746091fb.js";import"../../chunks/singletons-d1fb5791.js";function $t(s){let e,t,l;return{c(){e=Qe("svg"),t=Qe("circle"),l=Qe("path"),this.h()},l(a){e=Xe(a,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var c=b(e);t=Xe(c,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),b(t).forEach(i),l=Xe(c,"path",{class:!0,fill:!0,d:!0}),b(l).forEach(i),c.forEach(i),this.h()},h(){o(t,"class","opacity-25"),o(t,"cx","12"),o(t,"cy","12"),o(t,"r","10"),o(t,"stroke","currentColor"),o(t,"stroke-width","4"),o(l,"class","opacity-75"),o(l,"fill","currentColor"),o(l,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),o(e,"class","animate-spin -ml-1 mr-3 h-5 w-5 text-white"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24")},m(a,c){B(a,e,c),n(e,t),n(e,l)},d(a){a&&i(e)}}}function Gt(s){let e,t,l,a,c,p,r=s[0]&&$t();const m=s[2].default,f=Nt(m,s,s[1],null);return{c(){e=v("button"),r&&r.c(),t=V(),f&&f.c(),this.h()},l(u){e=g(u,"BUTTON",{type:!0,class:!0});var h=b(e);r&&r.l(h),t=P(h),f&&f.l(h),h.forEach(i),this.h()},h(){o(e,"type","submit"),e.disabled=s[0],o(e,"class",l="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(s[0]&&"opacity-50 cursor-not-allowed"))},m(u,h){B(u,e,h),r&&r.m(e,null),n(e,t),f&&f.m(e,null),a=!0,c||(p=ot(e,"click",s[3]),c=!0)},p(u,[h]){u[0]?r||(r=$t(),r.c(),r.m(e,t)):r&&(r.d(1),r=null),f&&f.p&&(!a||h&2)&&At(f,m,u,u[1],a?Ut(m,u[1],h,null):Tt(u[1]),null),(!a||h&1)&&(e.disabled=u[0]),(!a||h&1&&l!==(l="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(u[0]&&"opacity-50 cursor-not-allowed")))&&o(e,"class",l)},i(u){a||(se(f,u),a=!0)},o(u){oe(f,u),a=!1},d(u){u&&i(e),r&&r.d(),f&&f.d(u),c=!1,p()}}}function Zt(s,e,t){let{$$slots:l={},$$scope:a}=e,{loading:c=!1}=e;function p(r){Bt.call(this,s,r)}return s.$$set=r=>{"loading"in r&&t(0,c=r.loading),"$$scope"in r&&t(1,a=r.$$scope)},[c,a,l,p]}class st extends lt{constructor(e){super(),nt(this,e,Zt,Gt,at,{loading:0})}}function Dt(s,e,t){const l=s.slice();return l[6]=e[t],l}function qt(s){let e,t,l,a,c;return{c(){e=v("input"),this.h()},l(p){e=g(p,"INPUT",{name:!0,id:!0,class:!0,type:!0,step:!0}),this.h()},h(){o(e,"name",t=s[6].name),o(e,"id",l=s[6].name),o(e,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),o(e,"type",a=s[4](s[6])),e.value=c=s[3](s[6]),o(e,"step","any")},m(p,r){B(p,e,r)},p(p,r){r&1&&t!==(t=p[6].name)&&o(e,"name",t),r&1&&l!==(l=p[6].name)&&o(e,"id",l),r&1&&a!==(a=p[4](p[6]))&&o(e,"type",a),r&1&&c!==(c=p[3](p[6]))&&e.value!==c&&(e.value=c)},d(p){p&&i(e)}}}function Jt(s){let e,t,l,a,c,p,r;return{c(){e=v("input"),a=V(),c=v("input"),this.h()},l(m){e=g(m,"INPUT",{type:!0,name:!0,id:!0}),a=P(m),c=g(m,"INPUT",{type:!0,name:!0,id:!0,class:!0}),this.h()},h(){o(e,"type","hidden"),o(e,"name",t=s[6].name),o(e,"id",l=s[6].name),e.value="false",o(c,"type","checkbox"),o(c,"name",p=s[6].name),o(c,"id",r=s[6].name),o(c,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),c.value="true"},m(m,f){B(m,e,f),B(m,a,f),B(m,c,f)},p(m,f){f&1&&t!==(t=m[6].name)&&o(e,"name",t),f&1&&l!==(l=m[6].name)&&o(e,"id",l),f&1&&p!==(p=m[6].name)&&o(c,"name",p),f&1&&r!==(r=m[6].name)&&o(c,"id",r)},d(m){m&&i(e),m&&i(a),m&&i(c)}}}function xt(s){let e,t,l=s[6].description+"",a,c,p;function r(u,h){return u[6].schema.type==="boolean"?Jt:qt}let m=r(s),f=m(s);return{c(){e=v("label"),t=v("span"),a=j(l),c=V(),f.c(),this.h()},l(u){e=g(u,"LABEL",{class:!0,for:!0});var h=b(e);t=g(h,"SPAN",{class:!0});var N=b(t);a=S(N,l),N.forEach(i),c=P(h),f.l(h),h.forEach(i),this.h()},h(){o(t,"class","flex-auto"),o(e,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(e,"for",p=s[6].name),kt(e,"hidden",s[6].name==="instance_id")},m(u,h){B(u,e,h),n(e,t),n(t,a),n(e,c),f.m(e,null)},p(u,h){h&1&&l!==(l=u[6].description+"")&&L(a,l),m===(m=r(u))&&f?f.p(u,h):(f.d(1),f=m(u),f&&(f.c(),f.m(e,null))),h&1&&p!==(p=u[6].name)&&o(e,"for",p),h&1&&kt(e,"hidden",u[6].name==="instance_id")},d(u){u&&i(e),f.d()}}}function Kt(s){let e;return{c(){e=j("Run")},l(t){e=S(t,"Run")},m(t,l){B(t,e,l)},d(t){t&&i(e)}}}function Qt(s){let e,t,l=s[0].name+"",a,c,p,r=s[0].description+"",m,f,u,h,N,z,_,E,A=s[0].parameters,y=[];for(let k=0;k<A.length;k+=1)y[k]=xt(Dt(s,A,k));return N=new st({props:{loading:s[1],$$slots:{default:[Kt]},$$scope:{ctx:s}}}),{c(){e=v("div"),t=v("h1"),a=j(l),c=V(),p=v("p"),m=j(r),f=V(),u=v("form");for(let k=0;k<y.length;k+=1)y[k].c();h=V(),Ne(N.$$.fragment),this.h()},l(k){e=g(k,"DIV",{class:!0});var $=b(e);t=g($,"H1",{class:!0});var T=b(t);a=S(T,l),T.forEach(i),c=P($),p=g($,"P",{class:!0});var D=b(p);m=S(D,r),D.forEach(i),f=P($),u=g($,"FORM",{});var I=b(u);for(let x=0;x<y.length;x+=1)y[x].l(I);h=P(I),Ae(N.$$.fragment,I),I.forEach(i),$.forEach(i),this.h()},h(){o(t,"class","mb-2"),o(p,"class","text-sm mb-4"),o(e,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 ")},m(k,$){B(k,e,$),n(e,t),n(t,a),n(e,c),n(e,p),n(p,m),n(e,f),n(e,u);for(let T=0;T<y.length;T+=1)y[T].m(u,null);n(u,h),Te(N,u,null),z=!0,_||(E=ot(u,"submit",Ot(s[2])),_=!0)},p(k,[$]){if((!z||$&1)&&l!==(l=k[0].name+"")&&L(a,l),(!z||$&1)&&r!==(r=k[0].description+"")&&L(m,r),$&25){A=k[0].parameters;let D;for(D=0;D<A.length;D+=1){const I=Dt(k,A,D);y[D]?y[D].p(I,$):(y[D]=xt(I),y[D].c(),y[D].m(u,h))}for(;D<y.length;D+=1)y[D].d(1);y.length=A.length}const T={};$&2&&(T.loading=k[1]),$&512&&(T.$$scope={dirty:$,ctx:k}),N.$set(T)},i(k){z||(se(N.$$.fragment,k),z=!0)},o(k){oe(N.$$.fragment,k),z=!1},d(k){k&&i(e),jt(y,k),Ue(N),_=!1,E()}}}function Xt(s,e,t){let{instance:l}=e,{path:a}=e;console.log(a);let c=!1;const p=async f=>{t(1,c=!0);const u=new FormData(f.target),h={};for(let _ of u){const[E,A]=_;h[E]=A}const z=await(await ge(a.method,a.path,null,h)).json();console.log(z),t(1,c=!1)},r=f=>f.name==="instance_id"?l.id:f.schema.default,m=f=>{const u=f.schema.type;return u==="number"||u==="integer"?"number":u==="boolean"?"checkbox":"text"};return s.$$set=f=>{"instance"in f&&t(5,l=f.instance),"path"in f&&t(0,a=f.path)},[a,c,p,r,m,l]}class Yt extends lt{constructor(e){super(),nt(this,e,Xt,Qt,at,{instance:5,path:0})}}function yt(s,e,t){const l=s.slice();return l[11]=e[t],l}function es(s){let e;return{c(){e=j("Generate Instance")},l(t){e=S(t,"Generate Instance")},m(t,l){B(t,e,l)},d(t){t&&i(e)}}}function ts(s){let e;return{c(){e=j("Download ZIP")},l(t){e=S(t,"Download ZIP")},m(t,l){B(t,e,l)},d(t){t&&i(e)}}}function Vt(s){let e,t,l,a=s[3].task+"",c,p,r,m=s[3].completed+"",f,u,h=s[3].size+"",N,z,_,E,A=parseInt(s[3].progress*100)+"",y,k,$,T,D;return{c(){e=v("div"),t=v("div"),l=v("span"),c=j(a),p=V(),r=v("span"),f=j(m),u=j("/"),N=j(h),z=V(),_=v("div"),E=v("span"),y=j(A),k=j("%"),$=V(),T=v("div"),D=v("div"),this.h()},l(I){e=g(I,"DIV",{class:!0});var x=b(e);t=g(x,"DIV",{});var F=b(t);l=g(F,"SPAN",{class:!0});var re=b(l);c=S(re,a),re.forEach(i),p=P(F),r=g(F,"SPAN",{class:!0});var K=b(r);f=S(K,m),u=S(K,"/"),N=S(K,h),K.forEach(i),F.forEach(i),z=P(x),_=g(x,"DIV",{class:!0});var W=b(_);E=g(W,"SPAN",{class:!0});var G=b(E);y=S(G,A),k=S(G,"%"),G.forEach(i),W.forEach(i),x.forEach(i),$=P(I),T=g(I,"DIV",{class:!0});var le=b(T);D=g(le,"DIV",{style:!0,class:!0}),b(D).forEach(i),le.forEach(i),this.h()},h(){o(l,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(r,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(E,"class","text-xs font-semibold inline-block text-green-600"),o(_,"class","text-right"),o(e,"class","flex mb-2 items-center justify-between"),Et(D,"width",parseInt(s[3].progress*100)+"%"),o(D,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"),o(T,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200")},m(I,x){B(I,e,x),n(e,t),n(t,l),n(l,c),n(t,p),n(t,r),n(r,f),n(r,u),n(r,N),n(e,z),n(e,_),n(_,E),n(E,y),n(E,k),B(I,$,x),B(I,T,x),n(T,D)},p(I,x){x&8&&a!==(a=I[3].task+"")&&L(c,a),x&8&&m!==(m=I[3].completed+"")&&L(f,m),x&8&&h!==(h=I[3].size+"")&&L(N,h),x&8&&A!==(A=parseInt(I[3].progress*100)+"")&&L(y,A),x&8&&Et(D,"width",parseInt(I[3].progress*100)+"%")},d(I){I&&i(e),I&&i($),I&&i(T)}}}function Pt(s){let e,t;return e=new Yt({props:{instance:s[0],path:s[11]}}),{c(){Ne(e.$$.fragment)},l(l){Ae(e.$$.fragment,l)},m(l,a){Te(e,l,a),t=!0},p(l,a){const c={};a&1&&(c.instance=l[0]),a&16&&(c.path=l[11]),e.$set(c)},i(l){t||(se(e.$$.fragment,l),t=!0)},o(l){oe(e.$$.fragment,l),t=!1},d(l){Ue(e,l)}}}function ss(s){let e,t,l,a,c,p,r=s[0].label+"",m,f,u,h=s[0].status+"",N,z,_,E,A,y,k,$,T=s[0].iiif_url+"",D,I,x,F,re,K,W,G=s[0].id+"",le,Oe,Q,pe,ze,Ce,ie,me=new Date(s[0].created*1e3)+"",we,Le,X,he,Me,Re,ce,ne,_e=s[1]?"Connected":"Disconnected",ke,Ee,Fe,Y,be,He,We,fe,Z,Ge,Ie,Ze,ee,q,qe,J,$e,te,De,ue,M,Je,rt;q=new st({props:{loading:s[2],$$slots:{default:[es]},$$scope:{ctx:s}}}),q.$on("click",s[5]),J=new st({props:{loading:s[2],$$slots:{default:[ts]},$$scope:{ctx:s}}}),J.$on("click",s[6]);let C=s[3]&&Vt(s),ae=s[4],U=[];for(let d=0;d<ae.length;d+=1)U[d]=Pt(yt(s,ae,d));const St=d=>oe(U[d],1,1,()=>{U[d]=null});return{c(){e=v("div"),t=v("div"),l=v("button"),a=j("Delete"),c=V(),p=v("h1"),m=j(r),f=V(),u=v("span"),N=j(h),z=V(),_=v("div"),E=v("div"),A=v("p"),y=j("Manifest URL"),k=V(),$=v("div"),D=j(T),I=V(),x=v("div"),F=v("p"),re=j("Id"),K=V(),W=v("div"),le=j(G),Oe=V(),Q=v("div"),pe=v("p"),ze=j("Created"),Ce=V(),ie=v("div"),we=j(me),Le=V(),X=v("div"),he=v("p"),Me=j("Socket"),Re=V(),ce=v("div"),ne=v("span"),ke=j(_e),Fe=V(),Y=v("div"),be=v("p"),He=j("Vikus Viewer"),We=V(),fe=v("div"),Z=v("a"),Ge=j("Open"),Ze=V(),ee=v("div"),Ne(q.$$.fragment),qe=V(),Ne(J.$$.fragment),$e=V(),te=v("div"),C&&C.c(),De=V();for(let d=0;d<U.length;d+=1)U[d].c();ue=It(),this.h()},l(d){e=g(d,"DIV",{class:!0});var w=b(e);t=g(w,"DIV",{class:!0});var H=b(t);l=g(H,"BUTTON",{class:!0});var de=b(l);a=S(de,"Delete"),de.forEach(i),H.forEach(i),c=P(w),p=g(w,"H1",{});var O=b(p);m=S(O,r),f=P(O),u=g(O,"SPAN",{class:!0});var ve=b(u);N=S(ve,h),ve.forEach(i),O.forEach(i),w.forEach(i),z=P(d),_=g(d,"DIV",{class:!0});var R=b(_);E=g(R,"DIV",{class:!0});var xe=b(E);A=g(xe,"P",{});var it=b(A);y=S(it,"Manifest URL"),it.forEach(i),k=P(xe),$=g(xe,"DIV",{class:!0});var ct=b($);D=S(ct,T),ct.forEach(i),xe.forEach(i),I=P(R),x=g(R,"DIV",{class:!0});var ye=b(x);F=g(ye,"P",{});var ft=b(F);re=S(ft,"Id"),ft.forEach(i),K=P(ye),W=g(ye,"DIV",{class:!0});var ut=b(W);le=S(ut,G),ut.forEach(i),ye.forEach(i),Oe=P(R),Q=g(R,"DIV",{class:!0});var Ve=b(Q);pe=g(Ve,"P",{});var dt=b(pe);ze=S(dt,"Created"),dt.forEach(i),Ce=P(Ve),ie=g(Ve,"DIV",{class:!0});var pt=b(ie);we=S(pt,me),pt.forEach(i),Ve.forEach(i),Le=P(R),X=g(R,"DIV",{class:!0});var Pe=b(X);he=g(Pe,"P",{});var mt=b(he);Me=S(mt,"Socket"),mt.forEach(i),Re=P(Pe),ce=g(Pe,"DIV",{class:!0});var ht=b(ce);ne=g(ht,"SPAN",{class:!0});var _t=b(ne);ke=S(_t,_e),_t.forEach(i),ht.forEach(i),Pe.forEach(i),Fe=P(R),Y=g(R,"DIV",{class:!0});var je=b(Y);be=g(je,"P",{});var bt=b(be);He=S(bt,"Vikus Viewer"),bt.forEach(i),We=P(je),fe=g(je,"DIV",{class:!0});var vt=b(fe);Z=g(vt,"A",{target:!0,class:!0,href:!0});var gt=b(Z);Ge=S(gt,"Open"),gt.forEach(i),vt.forEach(i),je.forEach(i),Ze=P(R),ee=g(R,"DIV",{class:!0});var Se=b(ee);Ae(q.$$.fragment,Se),qe=P(Se),Ae(J.$$.fragment,Se),Se.forEach(i),R.forEach(i),$e=P(d),te=g(d,"DIV",{class:!0});var wt=b(te);C&&C.l(wt),wt.forEach(i),De=P(d);for(let Ke=0;Ke<U.length;Ke+=1)U[Ke].l(d);ue=It(),this.h()},h(){o(l,"class","p-1 pl-2 pr-2 bg-red-700 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-red-500/50 focus:outline-none"),o(t,"class","absolute top-0 right-0"),o(u,"class","px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"),o(e,"class","relative "),o($,"class","flex items-end text-xs"),o(E,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(W,"class","flex items-end text-xs"),o(x,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ie,"class","flex items-end text-xs"),o(Q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ne,"class",Ee="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(s[1]?"bg-green-100":"bg-red-100")+" text-"+(s[1]?"green-800":"red-800")),o(ce,"class","flex items-end text-xs"),o(X,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(Z,"target","_blank"),o(Z,"class","font-semibold rounded-full px-2 bg-blue-100"),o(Z,"href",Ie=et+"://"+Be+":"+tt+"/viewer/?config=../data/"+s[0].id+"/config.json"),o(fe,"class","flex items-end text-xs"),o(Y,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ee,"class","flex justify-between mt-8"),o(_,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-7"),o(te,"class","sticky top-20 flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-3")},m(d,w){B(d,e,w),n(e,t),n(t,l),n(l,a),n(e,c),n(e,p),n(p,m),n(p,f),n(p,u),n(u,N),B(d,z,w),B(d,_,w),n(_,E),n(E,A),n(A,y),n(E,k),n(E,$),n($,D),n(_,I),n(_,x),n(x,F),n(F,re),n(x,K),n(x,W),n(W,le),n(_,Oe),n(_,Q),n(Q,pe),n(pe,ze),n(Q,Ce),n(Q,ie),n(ie,we),n(_,Le),n(_,X),n(X,he),n(he,Me),n(X,Re),n(X,ce),n(ce,ne),n(ne,ke),n(_,Fe),n(_,Y),n(Y,be),n(be,He),n(Y,We),n(Y,fe),n(fe,Z),n(Z,Ge),n(_,Ze),n(_,ee),Te(q,ee,null),n(ee,qe),Te(J,ee,null),B(d,$e,w),B(d,te,w),C&&C.m(te,null),B(d,De,w);for(let H=0;H<U.length;H+=1)U[H].m(d,w);B(d,ue,w),M=!0,Je||(rt=ot(l,"click",s[7]),Je=!0)},p(d,[w]){(!M||w&1)&&r!==(r=d[0].label+"")&&L(m,r),(!M||w&1)&&h!==(h=d[0].status+"")&&L(N,h),(!M||w&1)&&T!==(T=d[0].iiif_url+"")&&L(D,T),(!M||w&1)&&G!==(G=d[0].id+"")&&L(le,G),(!M||w&1)&&me!==(me=new Date(d[0].created*1e3)+"")&&L(we,me),(!M||w&2)&&_e!==(_e=d[1]?"Connected":"Disconnected")&&L(ke,_e),(!M||w&2&&Ee!==(Ee="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(d[1]?"bg-green-100":"bg-red-100")+" text-"+(d[1]?"green-800":"red-800")))&&o(ne,"class",Ee),(!M||w&1&&Ie!==(Ie=et+"://"+Be+":"+tt+"/viewer/?config=../data/"+d[0].id+"/config.json"))&&o(Z,"href",Ie);const H={};w&4&&(H.loading=d[2]),w&16384&&(H.$$scope={dirty:w,ctx:d}),q.$set(H);const de={};if(w&4&&(de.loading=d[2]),w&16384&&(de.$$scope={dirty:w,ctx:d}),J.$set(de),d[3]?C?C.p(d,w):(C=Vt(d),C.c(),C.m(te,null)):C&&(C.d(1),C=null),w&17){ae=d[4];let O;for(O=0;O<ae.length;O+=1){const ve=yt(d,ae,O);U[O]?(U[O].p(ve,w),se(U[O],1)):(U[O]=Pt(ve),U[O].c(),se(U[O],1),U[O].m(ue.parentNode,ue))}for(Mt(),O=ae.length;O<U.length;O+=1)St(O);zt()}},i(d){if(!M){se(q.$$.fragment,d),se(J.$$.fragment,d);for(let w=0;w<ae.length;w+=1)se(U[w]);M=!0}},o(d){oe(q.$$.fragment,d),oe(J.$$.fragment,d),U=U.filter(Boolean);for(let w=0;w<U.length;w+=1)oe(U[w]);M=!1},d(d){d&&i(e),d&&i(z),d&&i(_),Ue(q),Ue(J),d&&i($e),d&&i(te),C&&C.d(),d&&i(De),jt(U,d),d&&i(ue),Je=!1,rt()}}}const ls={id:"test",label:"Disconnected Instance",iiif_url:"http://localhost:5000/instances/test",status:"ok"};async function ds({params:s,fetch:e,session:t,stuff:l}){try{const a=await ge("get",`/instances/${s.id}`);return{status:a.status,props:{instance:a.ok&&await a.json()}}}catch(a){return{status:a.status,props:{error:a.message,instance:ls}}}}function ns(s,e,t){let l;Ct(s,Ht,_=>t(4,l=_));let{instance:a}=e,c=!1,p=!1,r=!1,m=null;function f(){console.log("connection to websocket"),m&&m.close(),m=new WebSocket(`ws://${Be}:${Rt}/instances/${a.id}/ws`),m.onopen=_=>{console.log("eventSource.onopen",_),t(1,c=!0)},m.onerror=_=>{console.log("eventSource.onerror",_),t(1,c=!1)},m.onclose=_=>{console.log("eventSource.onclose",_),t(1,c=!1)},m.onmessage=_=>{const E=JSON.parse(_.data);E.type!="ping"&&console.log(E),E.task&&t(3,r=E)}}const u=setInterval(()=>{c||f()},2e3);Lt(()=>{console.log("It's destroyed"),t(1,c=!1),m.close(),clearInterval(u)});const h=async()=>{t(2,p=!0);const E=await(await ge("POST","/instances/generate",null,{instance_id:a.id})).json();console.log(E),t(2,p=!1)},N=async()=>{t(2,p=!0),await(await ge("POST","/instances/steps/zip",null,{instance_id:a.id})).json();const E=`${et}://${Be}:${tt}/data/${a.id}/project.zip`;var A=document.createElement("a");A.href=E,A.setAttribute("download","project.zip"),A.click()},z=async()=>{m.close(),(await(await ge("DELETE",`/instances/${a.id}`)).json()).status=="deleted"&&(Ft(),Wt(Ye?Ye:"/"))};return console.log("base",Ye),s.$$set=_=>{"instance"in _&&t(0,a=_.instance)},s.$$.update=()=>{s.$$.dirty&1&&(console.log(a),t(3,r=!1),t(1,c=!1),f())},[a,c,p,r,l,h,N,z]}class ps extends lt{constructor(e){super(),nt(this,e,ns,ss,at,{instance:0})}}export{ps as default,ds as load};
