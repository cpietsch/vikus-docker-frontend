import{S as kt,i as It,s as yt,e as f,t as j,k as N,c as u,a as h,h as P,d as c,m as O,b as d,T as pt,g as Z,H as e,j as W,P as Se,U as Pt,E as ht,V as Dt,f as mt,w as St,x as Tt,y as Nt,q as Te,o as Je,B as Ot,l as vt,p as At,Q as Ut,W as Bt,X as zt,n as Ct}from"../../chunks/index-8a66d5b6.js";import{b as re,p as Qe,d as me,c as Xe,a as bt}from"../../chunks/api-a1f7356f.js";import{w as Lt}from"../../chunks/index-9fbe470e.js";import{g as Rt}from"../../chunks/navigation-0e6511d1.js";import{b as Wt}from"../../chunks/paths-396f020f.js";import"../../chunks/singletons-d1fb5791.js";const Vt=Lt();async function Ft(){const t=await(await re("GET","/openapi.json")).json();console.log("openapi",t);const n=Object.entries(t.paths).filter(([a,l])=>a.startsWith("/instances/steps/")).filter(([a,l])=>a!=="/instances/steps/zip").map(([a,{post:l}])=>({path:a,method:"POST",description:l.description,parameters:l.parameters,name:l.summary,id:l.operationId}));console.log("paths",n),Vt.set(n)}Ft();function _t(s,t,n){const a=s.slice();return a[6]=t[n],a}function gt(s){let t,n,a=s[6].description+"",l,_,p,D,E,w,v,y,k;return{c(){t=f("label"),n=f("span"),l=j(a),_=N(),p=f("input"),this.h()},l(i){t=u(i,"LABEL",{class:!0,for:!0});var o=h(t);n=u(o,"SPAN",{class:!0});var V=h(n);l=P(V,a),V.forEach(c),_=O(o),p=u(o,"INPUT",{name:!0,id:!0,class:!0,type:!0,step:!0}),o.forEach(c),this.h()},h(){d(n,"class","flex-auto"),d(p,"name",D=s[6].name),d(p,"id",E=s[6].name),d(p,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),d(p,"type",w=s[4](s[6])),p.value=v=s[3](s[6]),p.checked=y=s[3](s[6]),d(p,"step","any"),d(t,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),d(t,"for",k=s[6].name),pt(t,"hidden",s[6].name==="instance_id")},m(i,o){Z(i,t,o),e(t,n),e(n,l),e(t,_),e(t,p)},p(i,o){o&1&&a!==(a=i[6].description+"")&&W(l,a),o&1&&D!==(D=i[6].name)&&d(p,"name",D),o&1&&E!==(E=i[6].name)&&d(p,"id",E),o&1&&w!==(w=i[4](i[6]))&&d(p,"type",w),o&1&&v!==(v=i[3](i[6]))&&p.value!==v&&(p.value=v),o&1&&y!==(y=i[3](i[6]))&&(p.checked=y),o&1&&k!==(k=i[6].name)&&d(t,"for",k),o&1&&pt(t,"hidden",i[6].name==="instance_id")},d(i){i&&c(t)}}}function Gt(s){let t,n,a=s[0].name+"",l,_,p,D=s[0].description+"",E,w,v,y,k,i,o,V,z,U=s[0].parameters,I=[];for(let m=0;m<U.length;m+=1)I[m]=gt(_t(s,U,m));return{c(){t=f("div"),n=f("h1"),l=j(a),_=N(),p=f("p"),E=j(D),w=N(),v=f("form");for(let m=0;m<I.length;m+=1)I[m].c();y=N(),k=f("button"),i=j("Run"),this.h()},l(m){t=u(m,"DIV",{class:!0});var g=h(t);n=u(g,"H1",{class:!0});var x=h(n);l=P(x,a),x.forEach(c),_=O(g),p=u(g,"P",{class:!0});var L=h(p);E=P(L,D),L.forEach(c),w=O(g),v=u(g,"FORM",{});var A=h(v);for(let G=0;G<I.length;G+=1)I[G].l(A);y=O(A),k=u(A,"BUTTON",{type:!0,class:!0});var F=h(k);i=P(F,"Run"),F.forEach(c),A.forEach(c),g.forEach(c),this.h()},h(){d(n,"class","mb-2"),d(p,"class","text-sm mb-4"),d(k,"type","submit"),d(k,"class","py-2 px-3 w-40 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none"),d(t,"class",o="flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 "+(s[1]&&"grayscale pointer-events-none"))},m(m,g){Z(m,t,g),e(t,n),e(n,l),e(t,_),e(t,p),e(p,E),e(t,w),e(t,v);for(let x=0;x<I.length;x+=1)I[x].m(v,null);e(v,y),e(v,k),e(k,i),V||(z=Se(v,"submit",Pt(s[2])),V=!0)},p(m,[g]){if(g&1&&a!==(a=m[0].name+"")&&W(l,a),g&1&&D!==(D=m[0].description+"")&&W(E,D),g&25){U=m[0].parameters;let x;for(x=0;x<U.length;x+=1){const L=_t(m,U,x);I[x]?I[x].p(L,g):(I[x]=gt(L),I[x].c(),I[x].m(v,y))}for(;x<I.length;x+=1)I[x].d(1);I.length=U.length}g&2&&o!==(o="flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 "+(m[1]&&"grayscale pointer-events-none"))&&d(t,"class",o)},i:ht,o:ht,d(m){m&&c(t),Dt(I,m),V=!1,z()}}}function Ht(s,t,n){let{instance:a}=t,{path:l}=t,_=!1;const p=async w=>{n(1,_=!0);const v=new FormData(w.target),y={};for(let o of v){const[V,z]=o;y[V]=z}const i=await(await re(l.method,l.path,null,y)).json();console.log(i),n(1,_=!1)},D=w=>w.name==="instance_id"?a.id:w.schema.default,E=w=>{const v=w.schema.type;return v==="number"||v==="integer"?"number":v==="boolean"?"checkbox":"text"};return s.$$set=w=>{"instance"in w&&n(5,a=w.instance),"path"in w&&n(0,l=w.path)},[l,_,p,D,E,a]}class Mt extends kt{constructor(t){super(),It(this,t,Ht,Gt,yt,{instance:5,path:0})}}function wt(s,t,n){const a=s.slice();return a[10]=t[n],a}function Et(s){let t,n,a,l,_=s[4].completed+"",p,D,E=s[4].size+"",w,v,y,k,i=parseInt(s[4].progress*100)+"",o,V,z,U,I;return{c(){t=f("div"),n=f("div"),a=f("div"),l=f("span"),p=j(_),D=j("/"),w=j(E),v=N(),y=f("div"),k=f("span"),o=j(i),V=j("%"),z=N(),U=f("div"),I=f("div"),this.h()},l(m){t=u(m,"DIV",{class:!0});var g=h(t);n=u(g,"DIV",{class:!0});var x=h(n);a=u(x,"DIV",{});var L=h(a);l=u(L,"SPAN",{class:!0});var A=h(l);p=P(A,_),D=P(A,"/"),w=P(A,E),A.forEach(c),L.forEach(c),v=O(x),y=u(x,"DIV",{class:!0});var F=h(y);k=u(F,"SPAN",{class:!0});var G=h(k);o=P(G,i),V=P(G,"%"),G.forEach(c),F.forEach(c),x.forEach(c),z=O(g),U=u(g,"DIV",{class:!0});var ee=h(U);I=u(ee,"DIV",{style:!0,class:!0}),h(I).forEach(c),ee.forEach(c),g.forEach(c),this.h()},h(){d(l,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),d(k,"class","text-xs font-semibold inline-block text-green-600"),d(y,"class","text-right"),d(n,"class","flex mb-2 items-center justify-between"),mt(I,"width",parseInt(s[4].progress*100)+"%"),d(I,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"),d(U,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200"),d(t,"class","relative mt-2")},m(m,g){Z(m,t,g),e(t,n),e(n,a),e(a,l),e(l,p),e(l,D),e(l,w),e(n,v),e(n,y),e(y,k),e(k,o),e(k,V),e(t,z),e(t,U),e(U,I)},p(m,g){g&16&&_!==(_=m[4].completed+"")&&W(p,_),g&16&&E!==(E=m[4].size+"")&&W(w,E),g&16&&i!==(i=parseInt(m[4].progress*100)+"")&&W(o,i),g&16&&mt(I,"width",parseInt(m[4].progress*100)+"%")},d(m){m&&c(t)}}}function xt(s){let t,n;return t=new Mt({props:{instance:s[0],path:s[10]}}),{c(){St(t.$$.fragment)},l(a){Tt(t.$$.fragment,a)},m(a,l){Nt(t,a,l),n=!0},p(a,l){const _={};l&1&&(_.instance=a[0]),l&2&&(_.path=a[10]),t.$set(_)},i(a){n||(Te(t.$$.fragment,a),n=!0)},o(a){Je(t.$$.fragment,a),n=!1},d(a){Ot(t,a)}}}function Zt(s){let t,n,a,l,_,p,D=s[0].label+"",E,w,v,y=s[0].status+"",k,i,o,V,z,U,I,m,g=s[0].iiif_url+"",x,L,A,F,G,ee,te,ie=s[0].id+"",ve,Ne,q,ce,Oe,Ae,se,de=new Date(s[0].created*1e3)+"",be,Ue,J,fe,Be,ze,ae,X,ue=s[2]?"Connected":"Disconnected",_e,ge,Ce,Q,pe,Le,Re,ne,H,We,we,Fe,M,K,Ge,He,Y,Me,Ee,xe,le,oe,C,Ze,Ke,B=s[4]&&Et(s),$=s[1],S=[];for(let r=0;r<$.length;r+=1)S[r]=xt(wt(s,$,r));const jt=r=>Je(S[r],1,1,()=>{S[r]=null});return{c(){t=f("div"),n=f("div"),a=f("button"),l=j("Delete"),_=N(),p=f("h1"),E=j(D),w=N(),v=f("span"),k=j(y),i=N(),o=f("div"),V=f("div"),z=f("p"),U=j("Manifest URL"),I=N(),m=f("div"),x=j(g),L=N(),A=f("div"),F=f("p"),G=j("Id"),ee=N(),te=f("div"),ve=j(ie),Ne=N(),q=f("div"),ce=f("p"),Oe=j("Created"),Ae=N(),se=f("div"),be=j(de),Ue=N(),J=f("div"),fe=f("p"),Be=j("Socket"),ze=N(),ae=f("div"),X=f("span"),_e=j(ue),Ce=N(),Q=f("div"),pe=f("p"),Le=j("Vikus Viewer"),Re=N(),ne=f("div"),H=f("a"),We=j("Open"),Fe=N(),M=f("div"),K=f("button"),Ge=j("Generate Instance"),He=N(),Y=f("button"),Me=j("Download ZIP"),xe=N(),B&&B.c(),le=N();for(let r=0;r<S.length;r+=1)S[r].c();oe=vt(),this.h()},l(r){t=u(r,"DIV",{class:!0});var b=h(t);n=u(b,"DIV",{class:!0});var T=h(n);a=u(T,"BUTTON",{class:!0});var he=h(a);l=P(he,"Delete"),he.forEach(c),T.forEach(c),_=O(b),p=u(b,"H1",{});var ke=h(p);E=P(ke,D),w=O(ke),v=u(ke,"SPAN",{class:!0});var Ye=h(v);k=P(Ye,y),Ye.forEach(c),ke.forEach(c),b.forEach(c),i=O(r),o=u(r,"DIV",{class:!0});var R=h(o);V=u(R,"DIV",{class:!0});var Ie=h(V);z=u(Ie,"P",{});var $e=h(z);U=P($e,"Manifest URL"),$e.forEach(c),I=O(Ie),m=u(Ie,"DIV",{class:!0});var et=h(m);x=P(et,g),et.forEach(c),Ie.forEach(c),L=O(R),A=u(R,"DIV",{class:!0});var ye=h(A);F=u(ye,"P",{});var tt=h(F);G=P(tt,"Id"),tt.forEach(c),ee=O(ye),te=u(ye,"DIV",{class:!0});var st=h(te);ve=P(st,ie),st.forEach(c),ye.forEach(c),Ne=O(R),q=u(R,"DIV",{class:!0});var De=h(q);ce=u(De,"P",{});var at=h(ce);Oe=P(at,"Created"),at.forEach(c),Ae=O(De),se=u(De,"DIV",{class:!0});var nt=h(se);be=P(nt,de),nt.forEach(c),De.forEach(c),Ue=O(R),J=u(R,"DIV",{class:!0});var Ve=h(J);fe=u(Ve,"P",{});var lt=h(fe);Be=P(lt,"Socket"),lt.forEach(c),ze=O(Ve),ae=u(Ve,"DIV",{class:!0});var ot=h(ae);X=u(ot,"SPAN",{class:!0});var rt=h(X);_e=P(rt,ue),rt.forEach(c),ot.forEach(c),Ve.forEach(c),Ce=O(R),Q=u(R,"DIV",{class:!0});var je=h(Q);pe=u(je,"P",{});var it=h(pe);Le=P(it,"Vikus Viewer"),it.forEach(c),Re=O(je),ne=u(je,"DIV",{class:!0});var ct=h(ne);H=u(ct,"A",{target:!0,class:!0,href:!0});var dt=h(H);We=P(dt,"Open"),dt.forEach(c),ct.forEach(c),je.forEach(c),Fe=O(R),M=u(R,"DIV",{class:!0});var Pe=h(M);K=u(Pe,"BUTTON",{class:!0});var ft=h(K);Ge=P(ft,"Generate Instance"),ft.forEach(c),He=O(Pe),Y=u(Pe,"BUTTON",{class:!0});var ut=h(Y);Me=P(ut,"Download ZIP"),ut.forEach(c),Pe.forEach(c),R.forEach(c),xe=O(r),B&&B.l(r),le=O(r);for(let qe=0;qe<S.length;qe+=1)S[qe].l(r);oe=vt(),this.h()},h(){d(a,"class","p-1 pl-2 pr-2 bg-red-700 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-red-500/50 focus:outline-none"),d(n,"class","absolute top-0 right-0 bg-gray-100"),d(v,"class","px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"),d(t,"class","relative "),d(m,"class","flex items-end text-xs"),d(V,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),d(te,"class","flex items-end text-xs"),d(A,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),d(se,"class","flex items-end text-xs"),d(q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),d(X,"class",ge="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(s[2]?"bg-green-100":"bg-red-100")+" text-"+(s[2]?"green-800":"red-800")),d(ae,"class","flex items-end text-xs"),d(J,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),d(H,"target","_blank"),d(H,"class","font-semibold rounded-full px-2 bg-blue-100"),d(H,"href",we=Qe+"://"+me+":"+Xe+"/viewer/?config=../data/"+s[0].id+"/config.json"),d(ne,"class","flex items-end text-xs"),d(Q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),d(K,"class","py-2 px-3 w-40 bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none"),d(Y,"class","py-2 px-3 w-40 bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none"),d(M,"class",Ee="flex justify-between mt-8 "+(s[3]&&"grayscale pointer-events-none")),d(o,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-7")},m(r,b){Z(r,t,b),e(t,n),e(n,a),e(a,l),e(t,_),e(t,p),e(p,E),e(p,w),e(p,v),e(v,k),Z(r,i,b),Z(r,o,b),e(o,V),e(V,z),e(z,U),e(V,I),e(V,m),e(m,x),e(o,L),e(o,A),e(A,F),e(F,G),e(A,ee),e(A,te),e(te,ve),e(o,Ne),e(o,q),e(q,ce),e(ce,Oe),e(q,Ae),e(q,se),e(se,be),e(o,Ue),e(o,J),e(J,fe),e(fe,Be),e(J,ze),e(J,ae),e(ae,X),e(X,_e),e(o,Ce),e(o,Q),e(Q,pe),e(pe,Le),e(Q,Re),e(Q,ne),e(ne,H),e(H,We),e(o,Fe),e(o,M),e(M,K),e(K,Ge),e(M,He),e(M,Y),e(Y,Me),Z(r,xe,b),B&&B.m(r,b),Z(r,le,b);for(let T=0;T<S.length;T+=1)S[T].m(r,b);Z(r,oe,b),C=!0,Ze||(Ke=[Se(a,"click",s[7]),Se(K,"click",s[5]),Se(Y,"click",s[6])],Ze=!0)},p(r,[b]){if((!C||b&1)&&D!==(D=r[0].label+"")&&W(E,D),(!C||b&1)&&y!==(y=r[0].status+"")&&W(k,y),(!C||b&1)&&g!==(g=r[0].iiif_url+"")&&W(x,g),(!C||b&1)&&ie!==(ie=r[0].id+"")&&W(ve,ie),(!C||b&1)&&de!==(de=new Date(r[0].created*1e3)+"")&&W(be,de),(!C||b&4)&&ue!==(ue=r[2]?"Connected":"Disconnected")&&W(_e,ue),(!C||b&4&&ge!==(ge="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(r[2]?"bg-green-100":"bg-red-100")+" text-"+(r[2]?"green-800":"red-800")))&&d(X,"class",ge),(!C||b&1&&we!==(we=Qe+"://"+me+":"+Xe+"/viewer/?config=../data/"+r[0].id+"/config.json"))&&d(H,"href",we),(!C||b&8&&Ee!==(Ee="flex justify-between mt-8 "+(r[3]&&"grayscale pointer-events-none")))&&d(M,"class",Ee),r[4]?B?B.p(r,b):(B=Et(r),B.c(),B.m(le.parentNode,le)):B&&(B.d(1),B=null),b&3){$=r[1];let T;for(T=0;T<$.length;T+=1){const he=wt(r,$,T);S[T]?(S[T].p(he,b),Te(S[T],1)):(S[T]=xt(he),S[T].c(),Te(S[T],1),S[T].m(oe.parentNode,oe))}for(Ct(),T=$.length;T<S.length;T+=1)jt(T);At()}},i(r){if(!C){for(let b=0;b<$.length;b+=1)Te(S[b]);C=!0}},o(r){S=S.filter(Boolean);for(let b=0;b<S.length;b+=1)Je(S[b]);C=!1},d(r){r&&c(t),r&&c(i),r&&c(o),r&&c(xe),B&&B.d(r),r&&c(le),Dt(S,r),r&&c(oe),Ze=!1,Ut(Ke)}}}const qt={id:"test",label:"Test Instance",iiif_url:"http://localhost:5000/instances/test",status:"ok"};async function ts({params:s,fetch:t,session:n,stuff:a}){try{const l=await re("get",`/instances/${s.id}`);return{status:l.status,props:{instance:l.ok&&await l.json()}}}catch(l){return{status:l.status,props:{error:l.message,instance:qt}}}}function Jt(s,t,n){let a;Bt(s,Vt,i=>n(1,a=i));let{instance:l}=t,_=!1,p=!1,D,E=new WebSocket(`ws://${me}:${bt}/instances/${l.id}/ws`);E.onopen=i=>{console.log("eventSource.onopen",i),n(2,_=!0)},E.onerror=i=>{console.log("eventSource.onerror",i),n(2,_=!1)},E.onclose=i=>{console.log("eventSource.onclose",i),n(2,_=!1)},E.onmessage=i=>{const o=JSON.parse(i.data);o.type!="ping"&&console.log(o),o.task&&n(4,D=o)};const w=setInterval(()=>{_||(E=new WebSocket(`ws://${me}:${bt}/instances/${l.id}/ws`))},1e3);zt(()=>{console.log("It's destroyed"),n(2,_=!1),E.close(),clearInterval(w)});const v=async()=>{const o=await(await re("POST","/instances/generate",null,{instance_id:l.id})).json();console.log(o),n(3,p=!1)},y=async()=>{await(await re("POST","/instances/steps/zip",null,{instance_id:l.id})).json();const o=`${Qe}://${me}:${Xe}/data/${l.id}/project.zip`;var V=document.createElement("a");V.href=o,V.setAttribute("download","project.zip"),V.click()},k=async()=>{E.close(),(await(await re("DELETE",`/instances/${l.id}`)).json()).status=="deleted"&&Rt(Wt)};return s.$$set=i=>{"instance"in i&&n(0,l=i.instance)},s.$$.update=()=>{s.$$.dirty&2&&console.log(a)},[l,a,_,p,D,v,y,k]}class ss extends kt{constructor(t){super(),It(this,t,Jt,Zt,yt,{instance:0})}}export{ss as default,ts as load};
