import{S as st,i as lt,s as nt,F as Xe,G as Ye,a as b,d as i,b as o,g as U,H as a,K as Tt,e as v,k as V,c as g,m as P,P as at,L as Nt,M as At,N as Ot,q as se,o as oe,T as Ut,t as j,h as S,U as wt,j as L,w as Te,x as Ne,y as Ae,V as zt,W as Pt,B as Oe,f as kt,l as Et,p as Bt,X as Ct,Y as Lt,n as Mt}from"../../chunks/index-b1f94317.js";import{b as pe,p as Qe,d as Ue,c as et,a as Rt}from"../../chunks/api-a1f7356f.js";import{w as Wt}from"../../chunks/index-1416d8d3.js";import{g as Ft}from"../../chunks/navigation-0e6511d1.js";import{b as Gt}from"../../chunks/paths-396f020f.js";import"../../chunks/singletons-d1fb5791.js";const jt=Wt();async function Ht(){const e=await(await pe("GET","/openapi.json")).json();console.log("openapi",e);const t=Object.entries(e.paths).filter(([s,n])=>s.startsWith("/instances/steps/")).filter(([s,n])=>s!=="/instances/steps/zip").map(([s,{post:n}])=>({path:s,method:"POST",description:n.description,parameters:n.parameters,name:n.summary,id:n.operationId}));console.log("paths",t),jt.set(t)}Ht();function It(l){let e,t,s;return{c(){e=Xe("svg"),t=Xe("circle"),s=Xe("path"),this.h()},l(n){e=Ye(n,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var c=b(e);t=Ye(c,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),b(t).forEach(i),s=Ye(c,"path",{class:!0,fill:!0,d:!0}),b(s).forEach(i),c.forEach(i),this.h()},h(){o(t,"class","opacity-25"),o(t,"cx","12"),o(t,"cy","12"),o(t,"r","10"),o(t,"stroke","currentColor"),o(t,"stroke-width","4"),o(s,"class","opacity-75"),o(s,"fill","currentColor"),o(s,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),o(e,"class","animate-spin -ml-1 mr-3 h-5 w-5 text-white"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24")},m(n,c){U(n,e,c),a(e,t),a(e,s)},d(n){n&&i(e)}}}function Zt(l){let e,t,s,n,c,p,r=l[0]&&It();const m=l[2].default,f=Tt(m,l,l[1],null);return{c(){e=v("button"),r&&r.c(),t=V(),f&&f.c(),this.h()},l(u){e=g(u,"BUTTON",{type:!0,class:!0});var h=b(e);r&&r.l(h),t=P(h),f&&f.l(h),h.forEach(i),this.h()},h(){o(e,"type","submit"),e.disabled=l[0],o(e,"class",s="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(l[0]&&"opacity-50 cursor-not-allowed"))},m(u,h){U(u,e,h),r&&r.m(e,null),a(e,t),f&&f.m(e,null),n=!0,c||(p=at(e,"click",l[3]),c=!0)},p(u,[h]){u[0]?r||(r=It(),r.c(),r.m(e,t)):r&&(r.d(1),r=null),f&&f.p&&(!n||h&2)&&Nt(f,m,u,u[1],n?Ot(m,u[1],h,null):At(u[1]),null),(!n||h&1)&&(e.disabled=u[0]),(!n||h&1&&s!==(s="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(u[0]&&"opacity-50 cursor-not-allowed")))&&o(e,"class",s)},i(u){n||(se(f,u),n=!0)},o(u){oe(f,u),n=!1},d(u){u&&i(e),r&&r.d(),f&&f.d(u),c=!1,p()}}}function qt(l,e,t){let{$$slots:s={},$$scope:n}=e,{loading:c=!1}=e;function p(r){Ut.call(this,l,r)}return l.$$set=r=>{"loading"in r&&t(0,c=r.loading),"$$scope"in r&&t(1,n=r.$$scope)},[c,n,s,p]}class tt extends st{constructor(e){super(),lt(this,e,qt,Zt,nt,{loading:0})}}function $t(l,e,t){const s=l.slice();return s[6]=e[t],s}function Jt(l){let e,t,s,n,c;return{c(){e=v("input"),this.h()},l(p){e=g(p,"INPUT",{name:!0,id:!0,class:!0,type:!0,step:!0}),this.h()},h(){o(e,"name",t=l[6].name),o(e,"id",s=l[6].name),o(e,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),o(e,"type",n=l[4](l[6])),e.value=c=l[3](l[6]),o(e,"step","any")},m(p,r){U(p,e,r)},p(p,r){r&1&&t!==(t=p[6].name)&&o(e,"name",t),r&1&&s!==(s=p[6].name)&&o(e,"id",s),r&1&&n!==(n=p[4](p[6]))&&o(e,"type",n),r&1&&c!==(c=p[3](p[6]))&&e.value!==c&&(e.value=c)},d(p){p&&i(e)}}}function Kt(l){let e,t,s,n,c,p,r;return{c(){e=v("input"),n=V(),c=v("input"),this.h()},l(m){e=g(m,"INPUT",{type:!0,name:!0,id:!0}),n=P(m),c=g(m,"INPUT",{type:!0,name:!0,id:!0,class:!0}),this.h()},h(){o(e,"type","hidden"),o(e,"name",t=l[6].name),o(e,"id",s=l[6].name),e.value="false",o(c,"type","checkbox"),o(c,"name",p=l[6].name),o(c,"id",r=l[6].name),o(c,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),c.value="true"},m(m,f){U(m,e,f),U(m,n,f),U(m,c,f)},p(m,f){f&1&&t!==(t=m[6].name)&&o(e,"name",t),f&1&&s!==(s=m[6].name)&&o(e,"id",s),f&1&&p!==(p=m[6].name)&&o(c,"name",p),f&1&&r!==(r=m[6].name)&&o(c,"id",r)},d(m){m&&i(e),m&&i(n),m&&i(c)}}}function Dt(l){let e,t,s=l[6].description+"",n,c,p;function r(u,h){return u[6].schema.type==="boolean"?Kt:Jt}let m=r(l),f=m(l);return{c(){e=v("label"),t=v("span"),n=j(s),c=V(),f.c(),this.h()},l(u){e=g(u,"LABEL",{class:!0,for:!0});var h=b(e);t=g(h,"SPAN",{class:!0});var T=b(t);n=S(T,s),T.forEach(i),c=P(h),f.l(h),h.forEach(i),this.h()},h(){o(t,"class","flex-auto"),o(e,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(e,"for",p=l[6].name),wt(e,"hidden",l[6].name==="instance_id")},m(u,h){U(u,e,h),a(e,t),a(t,n),a(e,c),f.m(e,null)},p(u,h){h&1&&s!==(s=u[6].description+"")&&L(n,s),m===(m=r(u))&&f?f.p(u,h):(f.d(1),f=m(u),f&&(f.c(),f.m(e,null))),h&1&&p!==(p=u[6].name)&&o(e,"for",p),h&1&&wt(e,"hidden",u[6].name==="instance_id")},d(u){u&&i(e),f.d()}}}function Xt(l){let e;return{c(){e=j("Run")},l(t){e=S(t,"Run")},m(t,s){U(t,e,s)},d(t){t&&i(e)}}}function Yt(l){let e,t,s=l[0].name+"",n,c,p,r=l[0].description+"",m,f,u,h,T,B,_,E,N=l[0].parameters,y=[];for(let k=0;k<N.length;k+=1)y[k]=Dt($t(l,N,k));return T=new tt({props:{loading:l[1],$$slots:{default:[Xt]},$$scope:{ctx:l}}}),{c(){e=v("div"),t=v("h1"),n=j(s),c=V(),p=v("p"),m=j(r),f=V(),u=v("form");for(let k=0;k<y.length;k+=1)y[k].c();h=V(),Te(T.$$.fragment),this.h()},l(k){e=g(k,"DIV",{class:!0});var $=b(e);t=g($,"H1",{class:!0});var A=b(t);n=S(A,s),A.forEach(i),c=P($),p=g($,"P",{class:!0});var D=b(p);m=S(D,r),D.forEach(i),f=P($),u=g($,"FORM",{});var I=b(u);for(let x=0;x<y.length;x+=1)y[x].l(I);h=P(I),Ne(T.$$.fragment,I),I.forEach(i),$.forEach(i),this.h()},h(){o(t,"class","mb-2"),o(p,"class","text-sm mb-4"),o(e,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 ")},m(k,$){U(k,e,$),a(e,t),a(t,n),a(e,c),a(e,p),a(p,m),a(e,f),a(e,u);for(let A=0;A<y.length;A+=1)y[A].m(u,null);a(u,h),Ae(T,u,null),B=!0,_||(E=at(u,"submit",zt(l[2])),_=!0)},p(k,[$]){if((!B||$&1)&&s!==(s=k[0].name+"")&&L(n,s),(!B||$&1)&&r!==(r=k[0].description+"")&&L(m,r),$&25){N=k[0].parameters;let D;for(D=0;D<N.length;D+=1){const I=$t(k,N,D);y[D]?y[D].p(I,$):(y[D]=Dt(I),y[D].c(),y[D].m(u,h))}for(;D<y.length;D+=1)y[D].d(1);y.length=N.length}const A={};$&2&&(A.loading=k[1]),$&512&&(A.$$scope={dirty:$,ctx:k}),T.$set(A)},i(k){B||(se(T.$$.fragment,k),B=!0)},o(k){oe(T.$$.fragment,k),B=!1},d(k){k&&i(e),Pt(y,k),Oe(T),_=!1,E()}}}function Qt(l,e,t){let{instance:s}=e,{path:n}=e;console.log(n);let c=!1;const p=async f=>{t(1,c=!0);const u=new FormData(f.target),h={};for(let _ of u){const[E,N]=_;h[E]=N}const B=await(await pe(n.method,n.path,null,h)).json();console.log(B),t(1,c=!1)},r=f=>f.name==="instance_id"?s.id:f.schema.default,m=f=>{const u=f.schema.type;return u==="number"||u==="integer"?"number":u==="boolean"?"checkbox":"text"};return l.$$set=f=>{"instance"in f&&t(5,s=f.instance),"path"in f&&t(0,n=f.path)},[n,c,p,r,m,s]}class es extends st{constructor(e){super(),lt(this,e,Qt,Yt,nt,{instance:5,path:0})}}function xt(l,e,t){const s=l.slice();return s[11]=e[t],s}function ts(l){let e;return{c(){e=j("Generate Instance")},l(t){e=S(t,"Generate Instance")},m(t,s){U(t,e,s)},d(t){t&&i(e)}}}function ss(l){let e;return{c(){e=j("Download ZIP")},l(t){e=S(t,"Download ZIP")},m(t,s){U(t,e,s)},d(t){t&&i(e)}}}function yt(l){let e,t,s,n=l[3].task+"",c,p,r,m=l[3].completed+"",f,u,h=l[3].size+"",T,B,_,E,N=parseInt(l[3].progress*100)+"",y,k,$,A,D;return{c(){e=v("div"),t=v("div"),s=v("span"),c=j(n),p=V(),r=v("span"),f=j(m),u=j("/"),T=j(h),B=V(),_=v("div"),E=v("span"),y=j(N),k=j("%"),$=V(),A=v("div"),D=v("div"),this.h()},l(I){e=g(I,"DIV",{class:!0});var x=b(e);t=g(x,"DIV",{});var W=b(t);s=g(W,"SPAN",{class:!0});var re=b(s);c=S(re,n),re.forEach(i),p=P(W),r=g(W,"SPAN",{class:!0});var K=b(r);f=S(K,m),u=S(K,"/"),T=S(K,h),K.forEach(i),W.forEach(i),B=P(x),_=g(x,"DIV",{class:!0});var G=b(_);E=g(G,"SPAN",{class:!0});var H=b(E);y=S(H,N),k=S(H,"%"),H.forEach(i),G.forEach(i),x.forEach(i),$=P(I),A=g(I,"DIV",{class:!0});var le=b(A);D=g(le,"DIV",{style:!0,class:!0}),b(D).forEach(i),le.forEach(i),this.h()},h(){o(s,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(r,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(E,"class","text-xs font-semibold inline-block text-green-600"),o(_,"class","text-right"),o(e,"class","flex mb-2 items-center justify-between"),kt(D,"width",parseInt(l[3].progress*100)+"%"),o(D,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"),o(A,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200")},m(I,x){U(I,e,x),a(e,t),a(t,s),a(s,c),a(t,p),a(t,r),a(r,f),a(r,u),a(r,T),a(e,B),a(e,_),a(_,E),a(E,y),a(E,k),U(I,$,x),U(I,A,x),a(A,D)},p(I,x){x&8&&n!==(n=I[3].task+"")&&L(c,n),x&8&&m!==(m=I[3].completed+"")&&L(f,m),x&8&&h!==(h=I[3].size+"")&&L(T,h),x&8&&N!==(N=parseInt(I[3].progress*100)+"")&&L(y,N),x&8&&kt(D,"width",parseInt(I[3].progress*100)+"%")},d(I){I&&i(e),I&&i($),I&&i(A)}}}function Vt(l){let e,t;return e=new es({props:{instance:l[0],path:l[11]}}),{c(){Te(e.$$.fragment)},l(s){Ne(e.$$.fragment,s)},m(s,n){Ae(e,s,n),t=!0},p(s,n){const c={};n&1&&(c.instance=s[0]),n&16&&(c.path=s[11]),e.$set(c)},i(s){t||(se(e.$$.fragment,s),t=!0)},o(s){oe(e.$$.fragment,s),t=!1},d(s){Oe(e,s)}}}function ls(l){let e,t,s,n,c,p,r=l[0].label+"",m,f,u,h=l[0].status+"",T,B,_,E,N,y,k,$,A=l[0].iiif_url+"",D,I,x,W,re,K,G,H=l[0].id+"",le,ze,X,me,Be,Ce,ie,he=new Date(l[0].created*1e3)+"",we,Le,Y,_e,Me,Re,ce,ne,be=l[1]?"Connected":"Disconnected",ke,Ee,We,Q,ve,Fe,Ge,fe,Z,He,Ie,Ze,ee,q,qe,J,$e,te,De,ue,M,Je,ot;q=new tt({props:{loading:l[2],$$slots:{default:[ts]},$$scope:{ctx:l}}}),q.$on("click",l[5]),J=new tt({props:{loading:l[2],$$slots:{default:[ss]},$$scope:{ctx:l}}}),J.$on("click",l[6]);let C=l[3]&&yt(l),ae=l[4],O=[];for(let d=0;d<ae.length;d+=1)O[d]=Vt(xt(l,ae,d));const St=d=>oe(O[d],1,1,()=>{O[d]=null});return{c(){e=v("div"),t=v("div"),s=v("button"),n=j("Delete"),c=V(),p=v("h1"),m=j(r),f=V(),u=v("span"),T=j(h),B=V(),_=v("div"),E=v("div"),N=v("p"),y=j("Manifest URL"),k=V(),$=v("div"),D=j(A),I=V(),x=v("div"),W=v("p"),re=j("Id"),K=V(),G=v("div"),le=j(H),ze=V(),X=v("div"),me=v("p"),Be=j("Created"),Ce=V(),ie=v("div"),we=j(he),Le=V(),Y=v("div"),_e=v("p"),Me=j("Socket"),Re=V(),ce=v("div"),ne=v("span"),ke=j(be),We=V(),Q=v("div"),ve=v("p"),Fe=j("Vikus Viewer"),Ge=V(),fe=v("div"),Z=v("a"),He=j("Open"),Ze=V(),ee=v("div"),Te(q.$$.fragment),qe=V(),Te(J.$$.fragment),$e=V(),te=v("div"),C&&C.c(),De=V();for(let d=0;d<O.length;d+=1)O[d].c();ue=Et(),this.h()},l(d){e=g(d,"DIV",{class:!0});var w=b(e);t=g(w,"DIV",{class:!0});var F=b(t);s=g(F,"BUTTON",{class:!0});var de=b(s);n=S(de,"Delete"),de.forEach(i),F.forEach(i),c=P(w),p=g(w,"H1",{});var z=b(p);m=S(z,r),f=P(z),u=g(z,"SPAN",{class:!0});var ge=b(u);T=S(ge,h),ge.forEach(i),z.forEach(i),w.forEach(i),B=P(d),_=g(d,"DIV",{class:!0});var R=b(_);E=g(R,"DIV",{class:!0});var xe=b(E);N=g(xe,"P",{});var rt=b(N);y=S(rt,"Manifest URL"),rt.forEach(i),k=P(xe),$=g(xe,"DIV",{class:!0});var it=b($);D=S(it,A),it.forEach(i),xe.forEach(i),I=P(R),x=g(R,"DIV",{class:!0});var ye=b(x);W=g(ye,"P",{});var ct=b(W);re=S(ct,"Id"),ct.forEach(i),K=P(ye),G=g(ye,"DIV",{class:!0});var ft=b(G);le=S(ft,H),ft.forEach(i),ye.forEach(i),ze=P(R),X=g(R,"DIV",{class:!0});var Ve=b(X);me=g(Ve,"P",{});var ut=b(me);Be=S(ut,"Created"),ut.forEach(i),Ce=P(Ve),ie=g(Ve,"DIV",{class:!0});var dt=b(ie);we=S(dt,he),dt.forEach(i),Ve.forEach(i),Le=P(R),Y=g(R,"DIV",{class:!0});var Pe=b(Y);_e=g(Pe,"P",{});var pt=b(_e);Me=S(pt,"Socket"),pt.forEach(i),Re=P(Pe),ce=g(Pe,"DIV",{class:!0});var mt=b(ce);ne=g(mt,"SPAN",{class:!0});var ht=b(ne);ke=S(ht,be),ht.forEach(i),mt.forEach(i),Pe.forEach(i),We=P(R),Q=g(R,"DIV",{class:!0});var je=b(Q);ve=g(je,"P",{});var _t=b(ve);Fe=S(_t,"Vikus Viewer"),_t.forEach(i),Ge=P(je),fe=g(je,"DIV",{class:!0});var bt=b(fe);Z=g(bt,"A",{target:!0,class:!0,href:!0});var vt=b(Z);He=S(vt,"Open"),vt.forEach(i),bt.forEach(i),je.forEach(i),Ze=P(R),ee=g(R,"DIV",{class:!0});var Se=b(ee);Ne(q.$$.fragment,Se),qe=P(Se),Ne(J.$$.fragment,Se),Se.forEach(i),R.forEach(i),$e=P(d),te=g(d,"DIV",{class:!0});var gt=b(te);C&&C.l(gt),gt.forEach(i),De=P(d);for(let Ke=0;Ke<O.length;Ke+=1)O[Ke].l(d);ue=Et(),this.h()},h(){o(s,"class","p-1 pl-2 pr-2 bg-red-700 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-red-500/50 focus:outline-none"),o(t,"class","absolute top-0 right-0"),o(u,"class","px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"),o(e,"class","relative "),o($,"class","flex items-end text-xs"),o(E,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(G,"class","flex items-end text-xs"),o(x,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ie,"class","flex items-end text-xs"),o(X,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ne,"class",Ee="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(l[1]?"bg-green-100":"bg-red-100")+" text-"+(l[1]?"green-800":"red-800")),o(ce,"class","flex items-end text-xs"),o(Y,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(Z,"target","_blank"),o(Z,"class","font-semibold rounded-full px-2 bg-blue-100"),o(Z,"href",Ie=Qe+"://"+Ue+":"+et+"/viewer/?config=../data/"+l[0].id+"/config.json"),o(fe,"class","flex items-end text-xs"),o(Q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ee,"class","flex justify-between mt-8"),o(_,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-7"),o(te,"class","sticky top-20 flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-3")},m(d,w){U(d,e,w),a(e,t),a(t,s),a(s,n),a(e,c),a(e,p),a(p,m),a(p,f),a(p,u),a(u,T),U(d,B,w),U(d,_,w),a(_,E),a(E,N),a(N,y),a(E,k),a(E,$),a($,D),a(_,I),a(_,x),a(x,W),a(W,re),a(x,K),a(x,G),a(G,le),a(_,ze),a(_,X),a(X,me),a(me,Be),a(X,Ce),a(X,ie),a(ie,we),a(_,Le),a(_,Y),a(Y,_e),a(_e,Me),a(Y,Re),a(Y,ce),a(ce,ne),a(ne,ke),a(_,We),a(_,Q),a(Q,ve),a(ve,Fe),a(Q,Ge),a(Q,fe),a(fe,Z),a(Z,He),a(_,Ze),a(_,ee),Ae(q,ee,null),a(ee,qe),Ae(J,ee,null),U(d,$e,w),U(d,te,w),C&&C.m(te,null),U(d,De,w);for(let F=0;F<O.length;F+=1)O[F].m(d,w);U(d,ue,w),M=!0,Je||(ot=at(s,"click",l[7]),Je=!0)},p(d,[w]){(!M||w&1)&&r!==(r=d[0].label+"")&&L(m,r),(!M||w&1)&&h!==(h=d[0].status+"")&&L(T,h),(!M||w&1)&&A!==(A=d[0].iiif_url+"")&&L(D,A),(!M||w&1)&&H!==(H=d[0].id+"")&&L(le,H),(!M||w&1)&&he!==(he=new Date(d[0].created*1e3)+"")&&L(we,he),(!M||w&2)&&be!==(be=d[1]?"Connected":"Disconnected")&&L(ke,be),(!M||w&2&&Ee!==(Ee="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(d[1]?"bg-green-100":"bg-red-100")+" text-"+(d[1]?"green-800":"red-800")))&&o(ne,"class",Ee),(!M||w&1&&Ie!==(Ie=Qe+"://"+Ue+":"+et+"/viewer/?config=../data/"+d[0].id+"/config.json"))&&o(Z,"href",Ie);const F={};w&4&&(F.loading=d[2]),w&16384&&(F.$$scope={dirty:w,ctx:d}),q.$set(F);const de={};if(w&4&&(de.loading=d[2]),w&16384&&(de.$$scope={dirty:w,ctx:d}),J.$set(de),d[3]?C?C.p(d,w):(C=yt(d),C.c(),C.m(te,null)):C&&(C.d(1),C=null),w&17){ae=d[4];let z;for(z=0;z<ae.length;z+=1){const ge=xt(d,ae,z);O[z]?(O[z].p(ge,w),se(O[z],1)):(O[z]=Vt(ge),O[z].c(),se(O[z],1),O[z].m(ue.parentNode,ue))}for(Mt(),z=ae.length;z<O.length;z+=1)St(z);Bt()}},i(d){if(!M){se(q.$$.fragment,d),se(J.$$.fragment,d);for(let w=0;w<ae.length;w+=1)se(O[w]);M=!0}},o(d){oe(q.$$.fragment,d),oe(J.$$.fragment,d),O=O.filter(Boolean);for(let w=0;w<O.length;w+=1)oe(O[w]);M=!1},d(d){d&&i(e),d&&i(B),d&&i(_),Oe(q),Oe(J),d&&i($e),d&&i(te),C&&C.d(),d&&i(De),Pt(O,d),d&&i(ue),Je=!1,ot()}}}const ns={id:"test",label:"Test Instance",iiif_url:"http://localhost:5000/instances/test",status:"ok"};async function ds({params:l,fetch:e,session:t,stuff:s}){try{const n=await pe("get",`/instances/${l.id}`);return{status:n.status,props:{instance:n.ok&&await n.json()}}}catch(n){return{status:n.status,props:{error:n.message,instance:ns}}}}function as(l,e,t){let s;Ct(l,jt,_=>t(4,s=_));let{instance:n}=e,c=!1,p=!1,r=!1,m=null;function f(){console.log("connection to websocket"),m&&m.close(),m=new WebSocket(`ws://${Ue}:${Rt}/instances/${n.id}/ws`),m.onopen=_=>{console.log("eventSource.onopen",_),t(1,c=!0)},m.onerror=_=>{console.log("eventSource.onerror",_),t(1,c=!1)},m.onclose=_=>{console.log("eventSource.onclose",_),t(1,c=!1)},m.onmessage=_=>{const E=JSON.parse(_.data);E.type!="ping"&&console.log(E),E.task&&t(3,r=E)}}const u=setInterval(()=>{c||f()},2e3);Lt(()=>{console.log("It's destroyed"),t(1,c=!1),m.close(),clearInterval(u)});const h=async()=>{t(2,p=!0);const E=await(await pe("POST","/instances/generate",null,{instance_id:n.id})).json();console.log(E),t(2,p=!1)},T=async()=>{t(2,p=!0),await(await pe("POST","/instances/steps/zip",null,{instance_id:n.id})).json();const E=`${Qe}://${Ue}:${et}/data/${n.id}/project.zip`;var N=document.createElement("a");N.href=E,N.setAttribute("download","project.zip"),N.click()},B=async()=>{m.close(),(await(await pe("DELETE",`/instances/${n.id}`)).json()).status=="deleted"&&Ft(Gt)};return l.$$set=_=>{"instance"in _&&t(0,n=_.instance)},l.$$.update=()=>{l.$$.dirty&1&&(console.log(n),t(3,r=!1),t(1,c=!1),f())},[n,c,p,r,s,h,T,B]}class ps extends st{constructor(e){super(),lt(this,e,as,ls,nt,{instance:0})}}export{ps as default,ds as load};
