import{S as tt,i as st,s as lt,F as Ke,G as Xe,a as _,d as u,b as o,g as U,H as n,K as St,e as v,k as V,c as b,m as j,P as at,L as Tt,M as Nt,N as At,q as Y,o as se,T as Ot,t as P,h as S,U as bt,j as R,w as Te,x as Ne,y as Ae,V as Ut,W as Vt,B as Oe,f as gt,l as wt,p as zt,X as Bt,Y as Ct,n as Lt}from"../../chunks/index-b1f94317.js";import{b as ue,p as Ye,d as ge,c as Qe,a as kt}from"../../chunks/api-a1f7356f.js";import{w as Mt}from"../../chunks/index-1416d8d3.js";import{g as Rt}from"../../chunks/navigation-0e6511d1.js";import{b as Wt}from"../../chunks/paths-396f020f.js";import"../../chunks/singletons-d1fb5791.js";const jt=Mt();async function Ft(){const e=await(await ue("GET","/openapi.json")).json();console.log("openapi",e);const t=Object.entries(e.paths).filter(([s,a])=>s.startsWith("/instances/steps/")).filter(([s,a])=>s!=="/instances/steps/zip").map(([s,{post:a}])=>({path:s,method:"POST",description:a.description,parameters:a.parameters,name:a.summary,id:a.operationId}));console.log("paths",t),jt.set(t)}Ft();function Et(l){let e,t,s;return{c(){e=Ke("svg"),t=Ke("circle"),s=Ke("path"),this.h()},l(a){e=Xe(a,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var r=_(e);t=Xe(r,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),_(t).forEach(u),s=Xe(r,"path",{class:!0,fill:!0,d:!0}),_(s).forEach(u),r.forEach(u),this.h()},h(){o(t,"class","opacity-25"),o(t,"cx","12"),o(t,"cy","12"),o(t,"r","10"),o(t,"stroke","currentColor"),o(t,"stroke-width","4"),o(s,"class","opacity-75"),o(s,"fill","currentColor"),o(s,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),o(e,"class","animate-spin -ml-1 mr-3 h-5 w-5 text-white"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24")},m(a,r){U(a,e,r),n(e,t),n(e,s)},d(a){a&&u(e)}}}function Gt(l){let e,t,s,a,r,p,d=l[0]&&Et();const m=l[2].default,f=St(m,l,l[1],null);return{c(){e=v("button"),d&&d.c(),t=V(),f&&f.c(),this.h()},l(i){e=b(i,"BUTTON",{type:!0,class:!0});var h=_(e);d&&d.l(h),t=j(h),f&&f.l(h),h.forEach(u),this.h()},h(){o(e,"type","submit"),e.disabled=l[0],o(e,"class",s="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(l[0]&&"opacity-50 cursor-not-allowed"))},m(i,h){U(i,e,h),d&&d.m(e,null),n(e,t),f&&f.m(e,null),a=!0,r||(p=at(e,"click",l[3]),r=!0)},p(i,[h]){i[0]?d||(d=Et(),d.c(),d.m(e,t)):d&&(d.d(1),d=null),f&&f.p&&(!a||h&2)&&Tt(f,m,i,i[1],a?At(m,i[1],h,null):Nt(i[1]),null),(!a||h&1)&&(e.disabled=i[0]),(!a||h&1&&s!==(s="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(i[0]&&"opacity-50 cursor-not-allowed")))&&o(e,"class",s)},i(i){a||(Y(f,i),a=!0)},o(i){se(f,i),a=!1},d(i){i&&u(e),d&&d.d(),f&&f.d(i),r=!1,p()}}}function Ht(l,e,t){let{$$slots:s={},$$scope:a}=e,{loading:r=!1}=e;function p(d){Ot.call(this,l,d)}return l.$$set=d=>{"loading"in d&&t(0,r=d.loading),"$$scope"in d&&t(1,a=d.$$scope)},[r,a,s,p]}class et extends tt{constructor(e){super(),st(this,e,Ht,Gt,lt,{loading:0})}}function $t(l,e,t){const s=l.slice();return s[6]=e[t],s}function Zt(l){let e,t,s,a,r;return{c(){e=v("input"),this.h()},l(p){e=b(p,"INPUT",{name:!0,id:!0,class:!0,type:!0,step:!0}),this.h()},h(){o(e,"name",t=l[6].name),o(e,"id",s=l[6].name),o(e,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),o(e,"type",a=l[4](l[6])),e.value=r=l[3](l[6]),o(e,"step","any")},m(p,d){U(p,e,d)},p(p,d){d&1&&t!==(t=p[6].name)&&o(e,"name",t),d&1&&s!==(s=p[6].name)&&o(e,"id",s),d&1&&a!==(a=p[4](p[6]))&&o(e,"type",a),d&1&&r!==(r=p[3](p[6]))&&e.value!==r&&(e.value=r)},d(p){p&&u(e)}}}function qt(l){let e,t,s,a,r,p,d;return{c(){e=v("input"),a=V(),r=v("input"),this.h()},l(m){e=b(m,"INPUT",{type:!0,name:!0,id:!0}),a=j(m),r=b(m,"INPUT",{type:!0,name:!0,id:!0,class:!0}),this.h()},h(){o(e,"type","hidden"),o(e,"name",t=l[6].name),o(e,"id",s=l[6].name),e.value="false",o(r,"type","checkbox"),o(r,"name",p=l[6].name),o(r,"id",d=l[6].name),o(r,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),r.value="true"},m(m,f){U(m,e,f),U(m,a,f),U(m,r,f)},p(m,f){f&1&&t!==(t=m[6].name)&&o(e,"name",t),f&1&&s!==(s=m[6].name)&&o(e,"id",s),f&1&&p!==(p=m[6].name)&&o(r,"name",p),f&1&&d!==(d=m[6].name)&&o(r,"id",d)},d(m){m&&u(e),m&&u(a),m&&u(r)}}}function It(l){let e,t,s=l[6].description+"",a,r,p;function d(i,h){return i[6].schema.type==="boolean"?qt:Zt}let m=d(l),f=m(l);return{c(){e=v("label"),t=v("span"),a=P(s),r=V(),f.c(),this.h()},l(i){e=b(i,"LABEL",{class:!0,for:!0});var h=_(e);t=b(h,"SPAN",{class:!0});var D=_(t);a=S(D,s),D.forEach(u),r=j(h),f.l(h),h.forEach(u),this.h()},h(){o(t,"class","flex-auto"),o(e,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(e,"for",p=l[6].name),bt(e,"hidden",l[6].name==="instance_id")},m(i,h){U(i,e,h),n(e,t),n(t,a),n(e,r),f.m(e,null)},p(i,h){h&1&&s!==(s=i[6].description+"")&&R(a,s),m===(m=d(i))&&f?f.p(i,h):(f.d(1),f=m(i),f&&(f.c(),f.m(e,null))),h&1&&p!==(p=i[6].name)&&o(e,"for",p),h&1&&bt(e,"hidden",i[6].name==="instance_id")},d(i){i&&u(e),f.d()}}}function Jt(l){let e;return{c(){e=P("Run")},l(t){e=S(t,"Run")},m(t,s){U(t,e,s)},d(t){t&&u(e)}}}function Kt(l){let e,t,s=l[0].name+"",a,r,p,d=l[0].description+"",m,f,i,h,D,E,w,N,O=l[0].parameters,y=[];for(let k=0;k<O.length;k+=1)y[k]=It($t(l,O,k));return D=new et({props:{loading:l[1],$$slots:{default:[Jt]},$$scope:{ctx:l}}}),{c(){e=v("div"),t=v("h1"),a=P(s),r=V(),p=v("p"),m=P(d),f=V(),i=v("form");for(let k=0;k<y.length;k+=1)y[k].c();h=V(),Te(D.$$.fragment),this.h()},l(k){e=b(k,"DIV",{class:!0});var $=_(e);t=b($,"H1",{class:!0});var I=_(t);a=S(I,s),I.forEach(u),r=j($),p=b($,"P",{class:!0});var x=_(p);m=S(x,d),x.forEach(u),f=j($),i=b($,"FORM",{});var C=_(i);for(let z=0;z<y.length;z+=1)y[z].l(C);h=j(C),Ne(D.$$.fragment,C),C.forEach(u),$.forEach(u),this.h()},h(){o(t,"class","mb-2"),o(p,"class","text-sm mb-4"),o(e,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 ")},m(k,$){U(k,e,$),n(e,t),n(t,a),n(e,r),n(e,p),n(p,m),n(e,f),n(e,i);for(let I=0;I<y.length;I+=1)y[I].m(i,null);n(i,h),Ae(D,i,null),E=!0,w||(N=at(i,"submit",Ut(l[2])),w=!0)},p(k,[$]){if((!E||$&1)&&s!==(s=k[0].name+"")&&R(a,s),(!E||$&1)&&d!==(d=k[0].description+"")&&R(m,d),$&25){O=k[0].parameters;let x;for(x=0;x<O.length;x+=1){const C=$t(k,O,x);y[x]?y[x].p(C,$):(y[x]=It(C),y[x].c(),y[x].m(i,h))}for(;x<y.length;x+=1)y[x].d(1);y.length=O.length}const I={};$&2&&(I.loading=k[1]),$&512&&(I.$$scope={dirty:$,ctx:k}),D.$set(I)},i(k){E||(Y(D.$$.fragment,k),E=!0)},o(k){se(D.$$.fragment,k),E=!1},d(k){k&&u(e),Vt(y,k),Oe(D),w=!1,N()}}}function Xt(l,e,t){let{instance:s}=e,{path:a}=e,r=!1;const p=async f=>{t(1,r=!0);const i=new FormData(f.target),h={};for(let w of i){const[N,O]=w;h[N]=O}const E=await(await ue(a.method,a.path,null,h)).json();console.log(E),t(1,r=!1)},d=f=>f.name==="instance_id"?s.id:f.schema.default,m=f=>{const i=f.schema.type;return i==="number"||i==="integer"?"number":i==="boolean"?"checkbox":"text"};return l.$$set=f=>{"instance"in f&&t(5,s=f.instance),"path"in f&&t(0,a=f.path)},[a,r,p,d,m,s]}class Yt extends tt{constructor(e){super(),st(this,e,Xt,Kt,lt,{instance:5,path:0})}}function Dt(l,e,t){const s=l.slice();return s[10]=e[t],s}function Qt(l){let e;return{c(){e=P("Generate Instance")},l(t){e=S(t,"Generate Instance")},m(t,s){U(t,e,s)},d(t){t&&u(e)}}}function es(l){let e;return{c(){e=P("Download ZIP")},l(t){e=S(t,"Download ZIP")},m(t,s){U(t,e,s)},d(t){t&&u(e)}}}function yt(l){let e,t,s,a,r=l[4].completed+"",p,d,m=l[4].size+"",f,i,h,D,E=parseInt(l[4].progress*100)+"",w,N,O,y,k;return{c(){e=v("div"),t=v("div"),s=v("div"),a=v("span"),p=P(r),d=P("/"),f=P(m),i=V(),h=v("div"),D=v("span"),w=P(E),N=P("%"),O=V(),y=v("div"),k=v("div"),this.h()},l($){e=b($,"DIV",{class:!0});var I=_(e);t=b(I,"DIV",{class:!0});var x=_(t);s=b(x,"DIV",{});var C=_(s);a=b(C,"SPAN",{class:!0});var z=_(a);p=S(z,r),d=S(z,"/"),f=S(z,m),z.forEach(u),C.forEach(u),i=j(x),h=b(x,"DIV",{class:!0});var Z=_(h);D=b(Z,"SPAN",{class:!0});var Q=_(D);w=S(Q,E),N=S(Q,"%"),Q.forEach(u),Z.forEach(u),x.forEach(u),O=j(I),y=b(I,"DIV",{class:!0});var le=_(y);k=b(le,"DIV",{style:!0,class:!0}),_(k).forEach(u),le.forEach(u),I.forEach(u),this.h()},h(){o(a,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(D,"class","text-xs font-semibold inline-block text-green-600"),o(h,"class","text-right"),o(t,"class","flex mb-2 items-center justify-between"),gt(k,"width",parseInt(l[4].progress*100)+"%"),o(k,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"),o(y,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200"),o(e,"class","relative mt-2")},m($,I){U($,e,I),n(e,t),n(t,s),n(s,a),n(a,p),n(a,d),n(a,f),n(t,i),n(t,h),n(h,D),n(D,w),n(D,N),n(e,O),n(e,y),n(y,k)},p($,I){I&16&&r!==(r=$[4].completed+"")&&R(p,r),I&16&&m!==(m=$[4].size+"")&&R(f,m),I&16&&E!==(E=parseInt($[4].progress*100)+"")&&R(w,E),I&16&&gt(k,"width",parseInt($[4].progress*100)+"%")},d($){$&&u(e)}}}function xt(l){let e,t;return e=new Yt({props:{instance:l[0],path:l[10]}}),{c(){Te(e.$$.fragment)},l(s){Ne(e.$$.fragment,s)},m(s,a){Ae(e,s,a),t=!0},p(s,a){const r={};a&1&&(r.instance=s[0]),a&2&&(r.path=s[10]),e.$set(r)},i(s){t||(Y(e.$$.fragment,s),t=!0)},o(s){se(e.$$.fragment,s),t=!1},d(s){Oe(e,s)}}}function ts(l){let e,t,s,a,r,p,d=l[0].label+"",m,f,i,h=l[0].status+"",D,E,w,N,O,y,k,$,I=l[0].iiif_url+"",x,C,z,Z,Q,le,ae,de=l[0].id+"",we,Ue,q,pe,ze,Be,ne,me=new Date(l[0].created*1e3)+"",ke,Ce,J,he,Le,Me,oe,ee,_e=l[2]?"Connected":"Disconnected",Ee,$e,Re,K,ve,We,Fe,re,F,Ge,Ie,He,X,G,Ze,H,De,ie,ce,L,qe,nt;G=new et({props:{loading:l[3],$$slots:{default:[Qt]},$$scope:{ctx:l}}}),G.$on("click",l[5]),H=new et({props:{loading:l[3],$$slots:{default:[es]},$$scope:{ctx:l}}}),H.$on("click",l[6]);let B=l[4]&&yt(l),te=l[1],T=[];for(let c=0;c<te.length;c+=1)T[c]=xt(Dt(l,te,c));const Pt=c=>se(T[c],1,1,()=>{T[c]=null});return{c(){e=v("div"),t=v("div"),s=v("button"),a=P("Delete"),r=V(),p=v("h1"),m=P(d),f=V(),i=v("span"),D=P(h),E=V(),w=v("div"),N=v("div"),O=v("p"),y=P("Manifest URL"),k=V(),$=v("div"),x=P(I),C=V(),z=v("div"),Z=v("p"),Q=P("Id"),le=V(),ae=v("div"),we=P(de),Ue=V(),q=v("div"),pe=v("p"),ze=P("Created"),Be=V(),ne=v("div"),ke=P(me),Ce=V(),J=v("div"),he=v("p"),Le=P("Socket"),Me=V(),oe=v("div"),ee=v("span"),Ee=P(_e),Re=V(),K=v("div"),ve=v("p"),We=P("Vikus Viewer"),Fe=V(),re=v("div"),F=v("a"),Ge=P("Open"),He=V(),X=v("div"),Te(G.$$.fragment),Ze=V(),Te(H.$$.fragment),De=V(),B&&B.c(),ie=V();for(let c=0;c<T.length;c+=1)T[c].c();ce=wt(),this.h()},l(c){e=b(c,"DIV",{class:!0});var g=_(e);t=b(g,"DIV",{class:!0});var W=_(t);s=b(W,"BUTTON",{class:!0});var fe=_(s);a=S(fe,"Delete"),fe.forEach(u),W.forEach(u),r=j(g),p=b(g,"H1",{});var A=_(p);m=S(A,d),f=j(A),i=b(A,"SPAN",{class:!0});var be=_(i);D=S(be,h),be.forEach(u),A.forEach(u),g.forEach(u),E=j(c),w=b(c,"DIV",{class:!0});var M=_(w);N=b(M,"DIV",{class:!0});var ye=_(N);O=b(ye,"P",{});var ot=_(O);y=S(ot,"Manifest URL"),ot.forEach(u),k=j(ye),$=b(ye,"DIV",{class:!0});var rt=_($);x=S(rt,I),rt.forEach(u),ye.forEach(u),C=j(M),z=b(M,"DIV",{class:!0});var xe=_(z);Z=b(xe,"P",{});var it=_(Z);Q=S(it,"Id"),it.forEach(u),le=j(xe),ae=b(xe,"DIV",{class:!0});var ct=_(ae);we=S(ct,de),ct.forEach(u),xe.forEach(u),Ue=j(M),q=b(M,"DIV",{class:!0});var Ve=_(q);pe=b(Ve,"P",{});var ft=_(pe);ze=S(ft,"Created"),ft.forEach(u),Be=j(Ve),ne=b(Ve,"DIV",{class:!0});var ut=_(ne);ke=S(ut,me),ut.forEach(u),Ve.forEach(u),Ce=j(M),J=b(M,"DIV",{class:!0});var je=_(J);he=b(je,"P",{});var dt=_(he);Le=S(dt,"Socket"),dt.forEach(u),Me=j(je),oe=b(je,"DIV",{class:!0});var pt=_(oe);ee=b(pt,"SPAN",{class:!0});var mt=_(ee);Ee=S(mt,_e),mt.forEach(u),pt.forEach(u),je.forEach(u),Re=j(M),K=b(M,"DIV",{class:!0});var Pe=_(K);ve=b(Pe,"P",{});var ht=_(ve);We=S(ht,"Vikus Viewer"),ht.forEach(u),Fe=j(Pe),re=b(Pe,"DIV",{class:!0});var _t=_(re);F=b(_t,"A",{target:!0,class:!0,href:!0});var vt=_(F);Ge=S(vt,"Open"),vt.forEach(u),_t.forEach(u),Pe.forEach(u),He=j(M),X=b(M,"DIV",{class:!0});var Se=_(X);Ne(G.$$.fragment,Se),Ze=j(Se),Ne(H.$$.fragment,Se),Se.forEach(u),M.forEach(u),De=j(c),B&&B.l(c),ie=j(c);for(let Je=0;Je<T.length;Je+=1)T[Je].l(c);ce=wt(),this.h()},h(){o(s,"class","p-1 pl-2 pr-2 bg-red-700 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-red-500/50 focus:outline-none"),o(t,"class","absolute top-0 right-0 bg-gray-100"),o(i,"class","px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"),o(e,"class","relative "),o($,"class","flex items-end text-xs"),o(N,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ae,"class","flex items-end text-xs"),o(z,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ne,"class","flex items-end text-xs"),o(q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ee,"class",$e="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(l[2]?"bg-green-100":"bg-red-100")+" text-"+(l[2]?"green-800":"red-800")),o(oe,"class","flex items-end text-xs"),o(J,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(F,"target","_blank"),o(F,"class","font-semibold rounded-full px-2 bg-blue-100"),o(F,"href",Ie=Ye+"://"+ge+":"+Qe+"/viewer/?config=../data/"+l[0].id+"/config.json"),o(re,"class","flex items-end text-xs"),o(K,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(X,"class","flex justify-between mt-8"),o(w,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-7")},m(c,g){U(c,e,g),n(e,t),n(t,s),n(s,a),n(e,r),n(e,p),n(p,m),n(p,f),n(p,i),n(i,D),U(c,E,g),U(c,w,g),n(w,N),n(N,O),n(O,y),n(N,k),n(N,$),n($,x),n(w,C),n(w,z),n(z,Z),n(Z,Q),n(z,le),n(z,ae),n(ae,we),n(w,Ue),n(w,q),n(q,pe),n(pe,ze),n(q,Be),n(q,ne),n(ne,ke),n(w,Ce),n(w,J),n(J,he),n(he,Le),n(J,Me),n(J,oe),n(oe,ee),n(ee,Ee),n(w,Re),n(w,K),n(K,ve),n(ve,We),n(K,Fe),n(K,re),n(re,F),n(F,Ge),n(w,He),n(w,X),Ae(G,X,null),n(X,Ze),Ae(H,X,null),U(c,De,g),B&&B.m(c,g),U(c,ie,g);for(let W=0;W<T.length;W+=1)T[W].m(c,g);U(c,ce,g),L=!0,qe||(nt=at(s,"click",l[7]),qe=!0)},p(c,[g]){(!L||g&1)&&d!==(d=c[0].label+"")&&R(m,d),(!L||g&1)&&h!==(h=c[0].status+"")&&R(D,h),(!L||g&1)&&I!==(I=c[0].iiif_url+"")&&R(x,I),(!L||g&1)&&de!==(de=c[0].id+"")&&R(we,de),(!L||g&1)&&me!==(me=new Date(c[0].created*1e3)+"")&&R(ke,me),(!L||g&4)&&_e!==(_e=c[2]?"Connected":"Disconnected")&&R(Ee,_e),(!L||g&4&&$e!==($e="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(c[2]?"bg-green-100":"bg-red-100")+" text-"+(c[2]?"green-800":"red-800")))&&o(ee,"class",$e),(!L||g&1&&Ie!==(Ie=Ye+"://"+ge+":"+Qe+"/viewer/?config=../data/"+c[0].id+"/config.json"))&&o(F,"href",Ie);const W={};g&8&&(W.loading=c[3]),g&8192&&(W.$$scope={dirty:g,ctx:c}),G.$set(W);const fe={};if(g&8&&(fe.loading=c[3]),g&8192&&(fe.$$scope={dirty:g,ctx:c}),H.$set(fe),c[4]?B?B.p(c,g):(B=yt(c),B.c(),B.m(ie.parentNode,ie)):B&&(B.d(1),B=null),g&3){te=c[1];let A;for(A=0;A<te.length;A+=1){const be=Dt(c,te,A);T[A]?(T[A].p(be,g),Y(T[A],1)):(T[A]=xt(be),T[A].c(),Y(T[A],1),T[A].m(ce.parentNode,ce))}for(Lt(),A=te.length;A<T.length;A+=1)Pt(A);zt()}},i(c){if(!L){Y(G.$$.fragment,c),Y(H.$$.fragment,c);for(let g=0;g<te.length;g+=1)Y(T[g]);L=!0}},o(c){se(G.$$.fragment,c),se(H.$$.fragment,c),T=T.filter(Boolean);for(let g=0;g<T.length;g+=1)se(T[g]);L=!1},d(c){c&&u(e),c&&u(E),c&&u(w),Oe(G),Oe(H),c&&u(De),B&&B.d(c),c&&u(ie),Vt(T,c),c&&u(ce),qe=!1,nt()}}}const ss={id:"test",label:"Test Instance",iiif_url:"http://localhost:5000/instances/test",status:"ok"};async function fs({params:l,fetch:e,session:t,stuff:s}){try{const a=await ue("get",`/instances/${l.id}`);return{status:a.status,props:{instance:a.ok&&await a.json()}}}catch(a){return{status:a.status,props:{error:a.message,instance:ss}}}}function ls(l,e,t){let s;Bt(l,jt,E=>t(1,s=E));let{instance:a}=e,r=!1,p=!1,d,m=new WebSocket(`ws://${ge}:${kt}/instances/${a.id}/ws`);m.onopen=E=>{console.log("eventSource.onopen",E),t(2,r=!0)},m.onerror=E=>{console.log("eventSource.onerror",E),t(2,r=!1)},m.onclose=E=>{console.log("eventSource.onclose",E),t(2,r=!1)},m.onmessage=E=>{const w=JSON.parse(E.data);w.type!="ping"&&console.log(w),w.task&&t(4,d=w)};const f=setInterval(()=>{r||(m=new WebSocket(`ws://${ge}:${kt}/instances/${a.id}/ws`))},1e3);Ct(()=>{console.log("It's destroyed"),t(2,r=!1),m.close(),clearInterval(f)});const i=async()=>{t(3,p=!0);const w=await(await ue("POST","/instances/generate",null,{instance_id:a.id})).json();console.log(w),t(3,p=!1)},h=async()=>{t(3,p=!0),await(await ue("POST","/instances/steps/zip",null,{instance_id:a.id})).json();const w=`${Ye}://${ge}:${Qe}/data/${a.id}/project.zip`;var N=document.createElement("a");N.href=w,N.setAttribute("download","project.zip"),N.click()},D=async()=>{m.close(),(await(await ue("DELETE",`/instances/${a.id}`)).json()).status=="deleted"&&Rt(Wt)};return l.$$set=E=>{"instance"in E&&t(0,a=E.instance)},l.$$.update=()=>{l.$$.dirty&2&&console.log(s)},[a,s,r,p,d,i,h,D]}class us extends tt{constructor(e){super(),st(this,e,ls,ts,lt,{instance:0})}}export{us as default,fs as load};
