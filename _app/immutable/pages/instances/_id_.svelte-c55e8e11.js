import{S as st,i as lt,s as nt,F as Xe,G as Ye,a as _,d as i,b as o,g as U,H as a,K as Nt,e as b,k as P,c as v,m as j,P as at,L as At,M as Ot,N as Ut,q as se,o as oe,T as zt,t as S,h as T,U as wt,j as L,w as Ne,x as Ae,y as Oe,V as Bt,W as jt,B as Ue,f as kt,l as Et,p as Ct,X as Lt,Y as Mt,n as Rt}from"../../chunks/index-b1f94317.js";import{b as pe,p as Qe,d as we,c as et,a as It}from"../../chunks/api-a1f7356f.js";import{w as Wt}from"../../chunks/index-1416d8d3.js";import{g as Ft}from"../../chunks/navigation-0e6511d1.js";import{b as Gt}from"../../chunks/paths-396f020f.js";import"../../chunks/singletons-d1fb5791.js";const St=Wt();async function Ht(){const e=await(await pe("GET","/openapi.json")).json();console.log("openapi",e);const t=Object.entries(e.paths).filter(([s,n])=>s.startsWith("/instances/steps/")).filter(([s,n])=>s!=="/instances/steps/zip").map(([s,{post:n}])=>({path:s,method:"POST",description:n.description,parameters:n.parameters,name:n.summary,id:n.operationId}));console.log("paths",t),St.set(t)}Ht();function $t(l){let e,t,s;return{c(){e=Xe("svg"),t=Xe("circle"),s=Xe("path"),this.h()},l(n){e=Ye(n,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var c=_(e);t=Ye(c,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),_(t).forEach(i),s=Ye(c,"path",{class:!0,fill:!0,d:!0}),_(s).forEach(i),c.forEach(i),this.h()},h(){o(t,"class","opacity-25"),o(t,"cx","12"),o(t,"cy","12"),o(t,"r","10"),o(t,"stroke","currentColor"),o(t,"stroke-width","4"),o(s,"class","opacity-75"),o(s,"fill","currentColor"),o(s,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),o(e,"class","animate-spin -ml-1 mr-3 h-5 w-5 text-white"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24")},m(n,c){U(n,e,c),a(e,t),a(e,s)},d(n){n&&i(e)}}}function Zt(l){let e,t,s,n,c,p,r=l[0]&&$t();const m=l[2].default,d=Nt(m,l,l[1],null);return{c(){e=b("button"),r&&r.c(),t=P(),d&&d.c(),this.h()},l(f){e=v(f,"BUTTON",{type:!0,class:!0});var h=_(e);r&&r.l(h),t=j(h),d&&d.l(h),h.forEach(i),this.h()},h(){o(e,"type","submit"),e.disabled=l[0],o(e,"class",s="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(l[0]&&"opacity-50 cursor-not-allowed"))},m(f,h){U(f,e,h),r&&r.m(e,null),a(e,t),d&&d.m(e,null),n=!0,c||(p=at(e,"click",l[3]),c=!0)},p(f,[h]){f[0]?r||(r=$t(),r.c(),r.m(e,t)):r&&(r.d(1),r=null),d&&d.p&&(!n||h&2)&&At(d,m,f,f[1],n?Ut(m,f[1],h,null):Ot(f[1]),null),(!n||h&1)&&(e.disabled=f[0]),(!n||h&1&&s!==(s="inline-flex items-center py-2 px-3 self-end bg-cyan-500 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-cyan-500/50 focus:outline-none "+(f[0]&&"opacity-50 cursor-not-allowed")))&&o(e,"class",s)},i(f){n||(se(d,f),n=!0)},o(f){oe(d,f),n=!1},d(f){f&&i(e),r&&r.d(),d&&d.d(f),c=!1,p()}}}function qt(l,e,t){let{$$slots:s={},$$scope:n}=e,{loading:c=!1}=e;function p(r){zt.call(this,l,r)}return l.$$set=r=>{"loading"in r&&t(0,c=r.loading),"$$scope"in r&&t(1,n=r.$$scope)},[c,n,s,p]}class tt extends st{constructor(e){super(),lt(this,e,qt,Zt,nt,{loading:0})}}function yt(l,e,t){const s=l.slice();return s[6]=e[t],s}function Jt(l){let e,t,s,n,c;return{c(){e=b("input"),this.h()},l(p){e=v(p,"INPUT",{name:!0,id:!0,class:!0,type:!0,step:!0}),this.h()},h(){o(e,"name",t=l[6].name),o(e,"id",s=l[6].name),o(e,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),o(e,"type",n=l[4](l[6])),e.value=c=l[3](l[6]),o(e,"step","any")},m(p,r){U(p,e,r)},p(p,r){r&1&&t!==(t=p[6].name)&&o(e,"name",t),r&1&&s!==(s=p[6].name)&&o(e,"id",s),r&1&&n!==(n=p[4](p[6]))&&o(e,"type",n),r&1&&c!==(c=p[3](p[6]))&&e.value!==c&&(e.value=c)},d(p){p&&i(e)}}}function Kt(l){let e,t,s,n,c,p,r;return{c(){e=b("input"),n=P(),c=b("input"),this.h()},l(m){e=v(m,"INPUT",{type:!0,name:!0,id:!0}),n=j(m),c=v(m,"INPUT",{type:!0,name:!0,id:!0,class:!0}),this.h()},h(){o(e,"type","hidden"),o(e,"name",t=l[6].name),o(e,"id",s=l[6].name),e.value="false",o(c,"type","checkbox"),o(c,"name",p=l[6].name),o(c,"id",r=l[6].name),o(c,"class","rounded-lg p-2 mr-1 border-2 border-gray-300"),c.value="true"},m(m,d){U(m,e,d),U(m,n,d),U(m,c,d)},p(m,d){d&1&&t!==(t=m[6].name)&&o(e,"name",t),d&1&&s!==(s=m[6].name)&&o(e,"id",s),d&1&&p!==(p=m[6].name)&&o(c,"name",p),d&1&&r!==(r=m[6].name)&&o(c,"id",r)},d(m){m&&i(e),m&&i(n),m&&i(c)}}}function Dt(l){let e,t,s=l[6].description+"",n,c,p;function r(f,h){return f[6].schema.type==="boolean"?Kt:Jt}let m=r(l),d=m(l);return{c(){e=b("label"),t=b("span"),n=S(s),c=P(),d.c(),this.h()},l(f){e=v(f,"LABEL",{class:!0,for:!0});var h=_(e);t=v(h,"SPAN",{class:!0});var N=_(t);n=T(N,s),N.forEach(i),c=j(h),d.l(h),h.forEach(i),this.h()},h(){o(t,"class","flex-auto"),o(e,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(e,"for",p=l[6].name),wt(e,"hidden",l[6].name==="instance_id")},m(f,h){U(f,e,h),a(e,t),a(t,n),a(e,c),d.m(e,null)},p(f,h){h&1&&s!==(s=f[6].description+"")&&L(n,s),m===(m=r(f))&&d?d.p(f,h):(d.d(1),d=m(f),d&&(d.c(),d.m(e,null))),h&1&&p!==(p=f[6].name)&&o(e,"for",p),h&1&&wt(e,"hidden",f[6].name==="instance_id")},d(f){f&&i(e),d.d()}}}function Xt(l){let e;return{c(){e=S("Run")},l(t){e=T(t,"Run")},m(t,s){U(t,e,s)},d(t){t&&i(e)}}}function Yt(l){let e,t,s=l[0].name+"",n,c,p,r=l[0].description+"",m,d,f,h,N,E,g,x,z=l[0].parameters,V=[];for(let k=0;k<z.length;k+=1)V[k]=Dt(yt(l,z,k));return N=new tt({props:{loading:l[1],$$slots:{default:[Xt]},$$scope:{ctx:l}}}),{c(){e=b("div"),t=b("h1"),n=S(s),c=P(),p=b("p"),m=S(r),d=P(),f=b("form");for(let k=0;k<V.length;k+=1)V[k].c();h=P(),Ne(N.$$.fragment),this.h()},l(k){e=v(k,"DIV",{class:!0});var $=_(e);t=v($,"H1",{class:!0});var A=_(t);n=T(A,s),A.forEach(i),c=j($),p=v($,"P",{class:!0});var y=_(p);m=T(y,r),y.forEach(i),d=j($),f=v($,"FORM",{});var I=_(f);for(let D=0;D<V.length;D+=1)V[D].l(I);h=j(I),Ae(N.$$.fragment,I),I.forEach(i),$.forEach(i),this.h()},h(){o(t,"class","mb-2"),o(p,"class","text-sm mb-4"),o(e,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-4 ")},m(k,$){U(k,e,$),a(e,t),a(t,n),a(e,c),a(e,p),a(p,m),a(e,d),a(e,f);for(let A=0;A<V.length;A+=1)V[A].m(f,null);a(f,h),Oe(N,f,null),E=!0,g||(x=at(f,"submit",Bt(l[2])),g=!0)},p(k,[$]){if((!E||$&1)&&s!==(s=k[0].name+"")&&L(n,s),(!E||$&1)&&r!==(r=k[0].description+"")&&L(m,r),$&25){z=k[0].parameters;let y;for(y=0;y<z.length;y+=1){const I=yt(k,z,y);V[y]?V[y].p(I,$):(V[y]=Dt(I),V[y].c(),V[y].m(f,h))}for(;y<V.length;y+=1)V[y].d(1);V.length=z.length}const A={};$&2&&(A.loading=k[1]),$&512&&(A.$$scope={dirty:$,ctx:k}),N.$set(A)},i(k){E||(se(N.$$.fragment,k),E=!0)},o(k){oe(N.$$.fragment,k),E=!1},d(k){k&&i(e),jt(V,k),Ue(N),g=!1,x()}}}function Qt(l,e,t){let{instance:s}=e,{path:n}=e;console.log(n);let c=!1;const p=async d=>{t(1,c=!0);const f=new FormData(d.target),h={};for(let g of f){const[x,z]=g;h[x]=z}const E=await(await pe(n.method,n.path,null,h)).json();console.log(E),t(1,c=!1)},r=d=>d.name==="instance_id"?s.id:d.schema.default,m=d=>{const f=d.schema.type;return f==="number"||f==="integer"?"number":f==="boolean"?"checkbox":"text"};return l.$$set=d=>{"instance"in d&&t(5,s=d.instance),"path"in d&&t(0,n=d.path)},[n,c,p,r,m,s]}class es extends st{constructor(e){super(),lt(this,e,Qt,Yt,nt,{instance:5,path:0})}}function xt(l,e,t){const s=l.slice();return s[10]=e[t],s}function ts(l){let e;return{c(){e=S("Generate Instance")},l(t){e=T(t,"Generate Instance")},m(t,s){U(t,e,s)},d(t){t&&i(e)}}}function ss(l){let e;return{c(){e=S("Download ZIP")},l(t){e=T(t,"Download ZIP")},m(t,s){U(t,e,s)},d(t){t&&i(e)}}}function Vt(l){let e,t,s,n=l[4].task+"",c,p,r,m=l[4].completed+"",d,f,h=l[4].size+"",N,E,g,x,z=parseInt(l[4].progress*100)+"",V,k,$,A,y;return{c(){e=b("div"),t=b("div"),s=b("span"),c=S(n),p=P(),r=b("span"),d=S(m),f=S("/"),N=S(h),E=P(),g=b("div"),x=b("span"),V=S(z),k=S("%"),$=P(),A=b("div"),y=b("div"),this.h()},l(I){e=v(I,"DIV",{class:!0});var D=_(e);t=v(D,"DIV",{});var W=_(t);s=v(W,"SPAN",{class:!0});var re=_(s);c=T(re,n),re.forEach(i),p=j(W),r=v(W,"SPAN",{class:!0});var K=_(r);d=T(K,m),f=T(K,"/"),N=T(K,h),K.forEach(i),W.forEach(i),E=j(D),g=v(D,"DIV",{class:!0});var G=_(g);x=v(G,"SPAN",{class:!0});var H=_(x);V=T(H,z),k=T(H,"%"),H.forEach(i),G.forEach(i),D.forEach(i),$=j(I),A=v(I,"DIV",{class:!0});var le=_(A);y=v(le,"DIV",{style:!0,class:!0}),_(y).forEach(i),le.forEach(i),this.h()},h(){o(s,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(r,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200"),o(x,"class","text-xs font-semibold inline-block text-green-600"),o(g,"class","text-right"),o(e,"class","flex mb-2 items-center justify-between"),kt(y,"width",parseInt(l[4].progress*100)+"%"),o(y,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"),o(A,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200")},m(I,D){U(I,e,D),a(e,t),a(t,s),a(s,c),a(t,p),a(t,r),a(r,d),a(r,f),a(r,N),a(e,E),a(e,g),a(g,x),a(x,V),a(x,k),U(I,$,D),U(I,A,D),a(A,y)},p(I,D){D&16&&n!==(n=I[4].task+"")&&L(c,n),D&16&&m!==(m=I[4].completed+"")&&L(d,m),D&16&&h!==(h=I[4].size+"")&&L(N,h),D&16&&z!==(z=parseInt(I[4].progress*100)+"")&&L(V,z),D&16&&kt(y,"width",parseInt(I[4].progress*100)+"%")},d(I){I&&i(e),I&&i($),I&&i(A)}}}function Pt(l){let e,t;return e=new es({props:{instance:l[0],path:l[10]}}),{c(){Ne(e.$$.fragment)},l(s){Ae(e.$$.fragment,s)},m(s,n){Oe(e,s,n),t=!0},p(s,n){const c={};n&1&&(c.instance=s[0]),n&2&&(c.path=s[10]),e.$set(c)},i(s){t||(se(e.$$.fragment,s),t=!0)},o(s){oe(e.$$.fragment,s),t=!1},d(s){Ue(e,s)}}}function ls(l){let e,t,s,n,c,p,r=l[0].label+"",m,d,f,h=l[0].status+"",N,E,g,x,z,V,k,$,A=l[0].iiif_url+"",y,I,D,W,re,K,G,H=l[0].id+"",le,ze,X,me,Be,Ce,ie,he=new Date(l[0].created*1e3)+"",ke,Le,Y,_e,Me,Re,ce,ne,be=l[2]?"Connected":"Disconnected",Ee,Ie,We,Q,ve,Fe,Ge,fe,Z,He,$e,Ze,ee,q,qe,J,ye,te,De,ue,M,Je,ot;q=new tt({props:{loading:l[3],$$slots:{default:[ts]},$$scope:{ctx:l}}}),q.$on("click",l[5]),J=new tt({props:{loading:l[3],$$slots:{default:[ss]},$$scope:{ctx:l}}}),J.$on("click",l[6]);let C=l[4]&&Vt(l),ae=l[1],O=[];for(let u=0;u<ae.length;u+=1)O[u]=Pt(xt(l,ae,u));const Tt=u=>oe(O[u],1,1,()=>{O[u]=null});return{c(){e=b("div"),t=b("div"),s=b("button"),n=S("Delete"),c=P(),p=b("h1"),m=S(r),d=P(),f=b("span"),N=S(h),E=P(),g=b("div"),x=b("div"),z=b("p"),V=S("Manifest URL"),k=P(),$=b("div"),y=S(A),I=P(),D=b("div"),W=b("p"),re=S("Id"),K=P(),G=b("div"),le=S(H),ze=P(),X=b("div"),me=b("p"),Be=S("Created"),Ce=P(),ie=b("div"),ke=S(he),Le=P(),Y=b("div"),_e=b("p"),Me=S("Socket"),Re=P(),ce=b("div"),ne=b("span"),Ee=S(be),We=P(),Q=b("div"),ve=b("p"),Fe=S("Vikus Viewer"),Ge=P(),fe=b("div"),Z=b("a"),He=S("Open"),Ze=P(),ee=b("div"),Ne(q.$$.fragment),qe=P(),Ne(J.$$.fragment),ye=P(),te=b("div"),C&&C.c(),De=P();for(let u=0;u<O.length;u+=1)O[u].c();ue=Et(),this.h()},l(u){e=v(u,"DIV",{class:!0});var w=_(e);t=v(w,"DIV",{class:!0});var F=_(t);s=v(F,"BUTTON",{class:!0});var de=_(s);n=T(de,"Delete"),de.forEach(i),F.forEach(i),c=j(w),p=v(w,"H1",{});var B=_(p);m=T(B,r),d=j(B),f=v(B,"SPAN",{class:!0});var ge=_(f);N=T(ge,h),ge.forEach(i),B.forEach(i),w.forEach(i),E=j(u),g=v(u,"DIV",{class:!0});var R=_(g);x=v(R,"DIV",{class:!0});var xe=_(x);z=v(xe,"P",{});var rt=_(z);V=T(rt,"Manifest URL"),rt.forEach(i),k=j(xe),$=v(xe,"DIV",{class:!0});var it=_($);y=T(it,A),it.forEach(i),xe.forEach(i),I=j(R),D=v(R,"DIV",{class:!0});var Ve=_(D);W=v(Ve,"P",{});var ct=_(W);re=T(ct,"Id"),ct.forEach(i),K=j(Ve),G=v(Ve,"DIV",{class:!0});var ft=_(G);le=T(ft,H),ft.forEach(i),Ve.forEach(i),ze=j(R),X=v(R,"DIV",{class:!0});var Pe=_(X);me=v(Pe,"P",{});var ut=_(me);Be=T(ut,"Created"),ut.forEach(i),Ce=j(Pe),ie=v(Pe,"DIV",{class:!0});var dt=_(ie);ke=T(dt,he),dt.forEach(i),Pe.forEach(i),Le=j(R),Y=v(R,"DIV",{class:!0});var je=_(Y);_e=v(je,"P",{});var pt=_(_e);Me=T(pt,"Socket"),pt.forEach(i),Re=j(je),ce=v(je,"DIV",{class:!0});var mt=_(ce);ne=v(mt,"SPAN",{class:!0});var ht=_(ne);Ee=T(ht,be),ht.forEach(i),mt.forEach(i),je.forEach(i),We=j(R),Q=v(R,"DIV",{class:!0});var Se=_(Q);ve=v(Se,"P",{});var _t=_(ve);Fe=T(_t,"Vikus Viewer"),_t.forEach(i),Ge=j(Se),fe=v(Se,"DIV",{class:!0});var bt=_(fe);Z=v(bt,"A",{target:!0,class:!0,href:!0});var vt=_(Z);He=T(vt,"Open"),vt.forEach(i),bt.forEach(i),Se.forEach(i),Ze=j(R),ee=v(R,"DIV",{class:!0});var Te=_(ee);Ae(q.$$.fragment,Te),qe=j(Te),Ae(J.$$.fragment,Te),Te.forEach(i),R.forEach(i),ye=j(u),te=v(u,"DIV",{class:!0});var gt=_(te);C&&C.l(gt),gt.forEach(i),De=j(u);for(let Ke=0;Ke<O.length;Ke+=1)O[Ke].l(u);ue=Et(),this.h()},h(){o(s,"class","p-1 pl-2 pr-2 bg-red-700 text-white text-sm font-semibold rounded-md shadow-lg hover:shadow-red-500/50 focus:outline-none"),o(t,"class","absolute top-0 right-0"),o(f,"class","px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"),o(e,"class","relative "),o($,"class","flex items-end text-xs"),o(x,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(G,"class","flex items-end text-xs"),o(D,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ie,"class","flex items-end text-xs"),o(X,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ne,"class",Ie="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(l[2]?"bg-green-100":"bg-red-100")+" text-"+(l[2]?"green-800":"red-800")),o(ce,"class","flex items-end text-xs"),o(Y,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(Z,"target","_blank"),o(Z,"class","font-semibold rounded-full px-2 bg-blue-100"),o(Z,"href",$e=Qe+"://"+we+":"+et+"/viewer/?config=../data/"+l[0].id+"/config.json"),o(fe,"class","flex items-end text-xs"),o(Q,"class","flex items-center pb-2 mb-2 text-sm space-x-12 md:space-x-24 justify-between border-b border-gray-200 dark:border-slate-600"),o(ee,"class","flex justify-between mt-8"),o(g,"class","flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-7"),o(te,"class","sticky top-20 flex shadow-xl rounded-xl p-8 bg-white dark:bg-slate-800 flex-col mt-3")},m(u,w){U(u,e,w),a(e,t),a(t,s),a(s,n),a(e,c),a(e,p),a(p,m),a(p,d),a(p,f),a(f,N),U(u,E,w),U(u,g,w),a(g,x),a(x,z),a(z,V),a(x,k),a(x,$),a($,y),a(g,I),a(g,D),a(D,W),a(W,re),a(D,K),a(D,G),a(G,le),a(g,ze),a(g,X),a(X,me),a(me,Be),a(X,Ce),a(X,ie),a(ie,ke),a(g,Le),a(g,Y),a(Y,_e),a(_e,Me),a(Y,Re),a(Y,ce),a(ce,ne),a(ne,Ee),a(g,We),a(g,Q),a(Q,ve),a(ve,Fe),a(Q,Ge),a(Q,fe),a(fe,Z),a(Z,He),a(g,Ze),a(g,ee),Oe(q,ee,null),a(ee,qe),Oe(J,ee,null),U(u,ye,w),U(u,te,w),C&&C.m(te,null),U(u,De,w);for(let F=0;F<O.length;F+=1)O[F].m(u,w);U(u,ue,w),M=!0,Je||(ot=at(s,"click",l[7]),Je=!0)},p(u,[w]){(!M||w&1)&&r!==(r=u[0].label+"")&&L(m,r),(!M||w&1)&&h!==(h=u[0].status+"")&&L(N,h),(!M||w&1)&&A!==(A=u[0].iiif_url+"")&&L(y,A),(!M||w&1)&&H!==(H=u[0].id+"")&&L(le,H),(!M||w&1)&&he!==(he=new Date(u[0].created*1e3)+"")&&L(ke,he),(!M||w&4)&&be!==(be=u[2]?"Connected":"Disconnected")&&L(Ee,be),(!M||w&4&&Ie!==(Ie="px-2 inline-flex text-xs leading-5 font-semibold rounded-full "+(u[2]?"bg-green-100":"bg-red-100")+" text-"+(u[2]?"green-800":"red-800")))&&o(ne,"class",Ie),(!M||w&1&&$e!==($e=Qe+"://"+we+":"+et+"/viewer/?config=../data/"+u[0].id+"/config.json"))&&o(Z,"href",$e);const F={};w&8&&(F.loading=u[3]),w&8192&&(F.$$scope={dirty:w,ctx:u}),q.$set(F);const de={};if(w&8&&(de.loading=u[3]),w&8192&&(de.$$scope={dirty:w,ctx:u}),J.$set(de),u[4]?C?C.p(u,w):(C=Vt(u),C.c(),C.m(te,null)):C&&(C.d(1),C=null),w&3){ae=u[1];let B;for(B=0;B<ae.length;B+=1){const ge=xt(u,ae,B);O[B]?(O[B].p(ge,w),se(O[B],1)):(O[B]=Pt(ge),O[B].c(),se(O[B],1),O[B].m(ue.parentNode,ue))}for(Rt(),B=ae.length;B<O.length;B+=1)Tt(B);Ct()}},i(u){if(!M){se(q.$$.fragment,u),se(J.$$.fragment,u);for(let w=0;w<ae.length;w+=1)se(O[w]);M=!0}},o(u){oe(q.$$.fragment,u),oe(J.$$.fragment,u),O=O.filter(Boolean);for(let w=0;w<O.length;w+=1)oe(O[w]);M=!1},d(u){u&&i(e),u&&i(E),u&&i(g),Ue(q),Ue(J),u&&i(ye),u&&i(te),C&&C.d(),u&&i(De),jt(O,u),u&&i(ue),Je=!1,ot()}}}const ns={id:"test",label:"Test Instance",iiif_url:"http://localhost:5000/instances/test",status:"ok"};async function ds({params:l,fetch:e,session:t,stuff:s}){try{const n=await pe("get",`/instances/${l.id}`);return{status:n.status,props:{instance:n.ok&&await n.json()}}}catch(n){return{status:n.status,props:{error:n.message,instance:ns}}}}function as(l,e,t){let s;Lt(l,St,E=>t(1,s=E));let{instance:n}=e,c=!1,p=!1,r=!1,m=new WebSocket(`ws://${we}:${It}/instances/${n.id}/ws`);m.onopen=E=>{console.log("eventSource.onopen",E),t(2,c=!0)},m.onerror=E=>{console.log("eventSource.onerror",E),t(2,c=!1)},m.onclose=E=>{console.log("eventSource.onclose",E),t(2,c=!1)},m.onmessage=E=>{const g=JSON.parse(E.data);g.type!="ping"&&console.log(g),g.task&&t(4,r=g)};const d=setInterval(()=>{console.log("timer"),!c&&(m=new WebSocket(`ws://${we}:${It}/instances/${n.id}/ws`))},1e3);Mt(()=>{console.log("It's destroyed"),t(2,c=!1),m.close(),clearInterval(d)});const f=async()=>{t(3,p=!0);const g=await(await pe("POST","/instances/generate",null,{instance_id:n.id})).json();console.log(g),t(3,p=!1)},h=async()=>{t(3,p=!0),await(await pe("POST","/instances/steps/zip",null,{instance_id:n.id})).json();const g=`${Qe}://${we}:${et}/data/${n.id}/project.zip`;var x=document.createElement("a");x.href=g,x.setAttribute("download","project.zip"),x.click()},N=async()=>{m.close(),(await(await pe("DELETE",`/instances/${n.id}`)).json()).status=="deleted"&&Ft(Gt)};return l.$$set=E=>{"instance"in E&&t(0,n=E.instance)},l.$$.update=()=>{l.$$.dirty&2&&console.log(s),l.$$.dirty&1&&(console.log(n),t(4,r=!1))},[n,s,c,p,r,f,h,N]}class ps extends st{constructor(e){super(),lt(this,e,as,ls,nt,{instance:0})}}export{ps as default,ds as load};
